
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://fightingff.github.io/notebooks/ADS/">
      
      
        <link rel="prev" href="../CS231n/">
      
      
        <link rel="next" href="../OOP/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.21">
    
    
      
        <title>ADS - FF's Notebooks</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.66ac8b77.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ads" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="FF&#39;s Notebooks" class="md-header__button md-logo" aria-label="FF's Notebooks" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FF's Notebooks
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ADS
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/fightingff/notebooks" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    fightingff/notebooks
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="FF&#39;s Notebooks" class="md-nav__button md-logo" aria-label="FF's Notebooks" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    FF's Notebooks
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/fightingff/notebooks" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    fightingff/notebooks
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://isshikihugh.github.io/zju-cs-asio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZJU CS Masters' Notes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Courses
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Courses
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    大一
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            大一
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ASM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    x86 Asm
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    大二上
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            大二上
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DigitLogic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Digit Logic Design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CS231n/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CS 231n
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    大二下
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            大二下
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    ADS
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    ADS
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-structrure" class="md-nav__link">
    <span class="md-ellipsis">
      Data Structrure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Structrure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#avl" class="md-nav__link">
    <span class="md-ellipsis">
      AVL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splay" class="md-nav__link">
    <span class="md-ellipsis">
      Splay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-tree" class="md-nav__link">
    <span class="md-ellipsis">
      B+ Tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rb-tree" class="md-nav__link">
    <span class="md-ellipsis">
      RB Tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reverse-index" class="md-nav__link">
    <span class="md-ellipsis">
      Reverse Index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leftist-tree" class="md-nav__link">
    <span class="md-ellipsis">
      Leftist Tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skew-heap" class="md-nav__link">
    <span class="md-ellipsis">
      Skew Heap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binomial-queue" class="md-nav__link">
    <span class="md-ellipsis">
      Binomial Queue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibonacci-heap" class="md-nav__link">
    <span class="md-ellipsis">
      Fibonacci Heap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#amortized-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Amortized Analysis (摊还分析)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backtracking" class="md-nav__link">
    <span class="md-ellipsis">
      BackTracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#divide-and-conquer" class="md-nav__link">
    <span class="md-ellipsis">
      Divide and Conquer（分治）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fft-fntt" class="md-nav__link">
    <span class="md-ellipsis">
      FFT &amp; FNTT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#greedy" class="md-nav__link">
    <span class="md-ellipsis">
      *Greedy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#np-completeness" class="md-nav__link">
    <span class="md-ellipsis">
      NP-Completeness
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#approximation" class="md-nav__link">
    <span class="md-ellipsis">
      Approximation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-search" class="md-nav__link">
    <span class="md-ellipsis">
      Local Search
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#randomized-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Randomized Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel" class="md-nav__link">
    <span class="md-ellipsis">
      Parallel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-sorting" class="md-nav__link">
    <span class="md-ellipsis">
      External Sorting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OOP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OOP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Info/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Information Theory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Database/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RiscV/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Computer Organization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tools
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Make/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Makefile & CMake
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Materials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Materials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AI_Materials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AI Materials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/fightingff/AI" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    My AI Repository
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-structrure" class="md-nav__link">
    <span class="md-ellipsis">
      Data Structrure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Structrure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#avl" class="md-nav__link">
    <span class="md-ellipsis">
      AVL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splay" class="md-nav__link">
    <span class="md-ellipsis">
      Splay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-tree" class="md-nav__link">
    <span class="md-ellipsis">
      B+ Tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rb-tree" class="md-nav__link">
    <span class="md-ellipsis">
      RB Tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reverse-index" class="md-nav__link">
    <span class="md-ellipsis">
      Reverse Index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leftist-tree" class="md-nav__link">
    <span class="md-ellipsis">
      Leftist Tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skew-heap" class="md-nav__link">
    <span class="md-ellipsis">
      Skew Heap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binomial-queue" class="md-nav__link">
    <span class="md-ellipsis">
      Binomial Queue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibonacci-heap" class="md-nav__link">
    <span class="md-ellipsis">
      Fibonacci Heap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#amortized-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Amortized Analysis (摊还分析)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backtracking" class="md-nav__link">
    <span class="md-ellipsis">
      BackTracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#divide-and-conquer" class="md-nav__link">
    <span class="md-ellipsis">
      Divide and Conquer（分治）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fft-fntt" class="md-nav__link">
    <span class="md-ellipsis">
      FFT &amp; FNTT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#greedy" class="md-nav__link">
    <span class="md-ellipsis">
      *Greedy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#np-completeness" class="md-nav__link">
    <span class="md-ellipsis">
      NP-Completeness
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#approximation" class="md-nav__link">
    <span class="md-ellipsis">
      Approximation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-search" class="md-nav__link">
    <span class="md-ellipsis">
      Local Search
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#randomized-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Randomized Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel" class="md-nav__link">
    <span class="md-ellipsis">
      Parallel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-sorting" class="md-nav__link">
    <span class="md-ellipsis">
      External Sorting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="ads">ADS</h1>
<blockquote>
<p><em>第一节课就讲了AVL+Splay+摊还分析，让信息竞赛退役选手的我已经汗流浃背……</em></p>
</blockquote>
<h2 id="data-structrure">Data Structrure</h2>
<hr />
<h3 id="avl">AVL</h3>
<blockquote>
<p>定义：任意节点左右子树<strong>高度差</strong>不大于1</p>
<p><strong>Balance factor = <span class="arithmatex">\(h_L - h_R \in \set{-1, 0, 1}\)</span></strong></p>
</blockquote>
<ul>
<li>
<p>复杂度分析：</p>
<ul>
<li>
<p>对于常见操作（插入、删除、查询）<span class="arithmatex">\(O(h)\)</span></p>
</li>
<li>
<p>由定义，让高度最大，有<span class="arithmatex">\(N_{h} = N_{h-1} + N_{h-2} + 1\)</span></p>
</li>
<li>
<p>化简，得到<span class="arithmatex">\((N_{h} + 1)= (N_{h-1} + 1) + (N_{h-2} + 1)\)</span></p>
</li>
<li>
<p>由斐波那契数列相关知识，得<span class="arithmatex">\(N_h = F_{h+3} - 1\)</span> (空树为-1)</p>
</li>
<li>
<p>由此可得，<span class="arithmatex">\(h = O(\log N)\)</span></p>
</li>
</ul>
</li>
<li>
<p>维护（Rotation）</p>
<ul>
<li>
<p>由定义的严格性，可知只要处理最小不平衡子树即可，并且上面还有可能不平衡，旋转复杂度也为<span class="arithmatex">\(O(h)\)</span></p>
</li>
<li>
<p><strong>个人感觉旋转反而不够直观，更像是将下面的节点往上面“拎”起来，从而该节点（子树根节点）的各个儿子向两边“掉下去”，整棵子树也就像是被展平了一样更加平衡了。需要注意的是更新的节点在下方，而真正处理（即结构报错）的节点在上方作为Grandparent</strong></p>
</li>
<li>
<p>LL / RR Rotation</p>
<ul>
<li>
<p>单链倾斜，将中间节点拎起来（将中间节点向上旋转）就好</p>
</li>
<li>
<p><img alt="LL / RR Rotation" src="../images/LL.png" /></p>
</li>
</ul>
</li>
<li>
<p>LR / RL Rotation</p>
<ul>
<li>
<p>弯曲链，将权值为中间值（最下端儿子）的节点拎起来，该节点的两个儿子分别向两边掉下去</p>
</li>
<li>
<p>还有一种理解，将这种情况理解为最下端儿子向上rotation两次 </p>
</li>
<li>
<p><img alt="LR / RL Rotation" src="../images/LR.png" /></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<details class="collapsible">
<summary>Code</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">AVL Tree</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Rs</span><span class="p">;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="n">Node</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">data</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">Ls</span><span class="p">(</span><span class="nb">NULL</span><span class="p">),</span><span class="w"> </span><span class="n">Rs</span><span class="p">(</span><span class="nb">NULL</span><span class="p">){}</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Update</span><span class="p">(){</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">HL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="n">HR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Ls</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">HL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ls</span><span class="o">-&gt;</span><span class="n">H</span><span class="p">;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Rs</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">HR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rs</span><span class="o">-&gt;</span><span class="n">H</span><span class="p">;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">        </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">HL</span><span class="p">,</span><span class="w"> </span><span class="n">HR</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">HL</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">HR</span><span class="p">);</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="p">};</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="k">struct</span><span class="w"> </span><span class="nc">AVL</span><span class="p">{</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Rot</span><span class="p">;</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="c1">//Structure</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Clear</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">)</span><span class="w"> </span><span class="n">Clear</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">);</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">)</span><span class="w"> </span><span class="n">Clear</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">);</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">        </span><span class="k">delete</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="nf">Insert</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Insert</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="k">else</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Insert</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Update</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Balance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Rotate</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">**</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">**</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">p</span><span class="p">){</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">        </span><span class="c1">// p = 0 -&gt; Left, p = 1 -&gt; Right</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">        </span><span class="c1">// rotate X to Y</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">){</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">            </span><span class="p">(</span><span class="o">*</span><span class="n">Y</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">            </span><span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">Y</span><span class="p">;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">            </span><span class="p">(</span><span class="o">*</span><span class="n">Y</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">            </span><span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">Y</span><span class="p">;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">        </span><span class="p">(</span><span class="o">*</span><span class="n">Y</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Update</span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Update</span><span class="p">();</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="nf">Balance</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Trouble</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">G</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Trouble</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">X</span><span class="p">;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">G</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="k">else</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="k">else</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="n">Rotate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">),</span><span class="w"> </span><span class="n">Rotate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">G</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="n">Rotate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">G</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">;</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">X</span><span class="p">;</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Print</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">)</span><span class="w"> </span><span class="n">Print</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">);</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">)</span><span class="w"> </span><span class="n">Print</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">);</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="w">    </span><span class="c1">// User</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Clear</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="n">Rot</span><span class="p">)</span><span class="w"> </span><span class="n">Clear</span><span class="p">(</span><span class="n">Rot</span><span class="p">);</span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;}</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">PrintRoot</span><span class="p">(){</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);}</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Insert</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Insert</span><span class="p">(</span><span class="n">Rot</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);}</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="p">}</span><span class="n">Tree</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</details>
<hr />
<h3 id="splay">Splay</h3>
<ul>
<li>
<p>每次查询时，将查询的节点旋转到根节点，从而在过程中将树展平</p>
</li>
<li>
<p><em>由于动态自适应等特性，实际上splay树非常强大</em></p>
</li>
<li>
<p>均摊复杂度：<span class="arithmatex">\(O(\log N)\)</span></p>
</li>
<li>
<p>维护（ZigZag）</p>
<ul>
<li>
<p>目的与AVL略有不同，AVL完全是为了保持树的平衡，而Splay是为了将查询的节点向上移动的同时尽量展平树（一般为每次考虑当前节点、父节点和祖先节点，选择最合适的旋转方法）</p>
</li>
<li>
<p>Zig</p>
<ul>
<li>
<p>已经是根节点的儿子，直接向上旋转一次即可</p>
</li>
<li>
<p><img alt="Zig" src="../images/Zig.png" /> </p>
</li>
</ul>
</li>
<li>
<p>ZigZig</p>
<ul>
<li>
<p>倾斜链，将当前节点的父节点向上旋转一次，再将当前节点向上旋转一次</p>
</li>
<li>
<p><em>不能直接将当前节点向上旋转两次，因为这样会导致倾斜链歪向另一边</em></p>
</li>
<li>
<p>也可以看成直接将当前节点往最上面一提，剩下的儿子们“纷纷”往下掉</p>
</li>
<li>
<p><img alt="ZigZig" src="../images/ZigZig.png" /></p>
</li>
</ul>
</li>
<li>
<p>ZigZag </p>
<ul>
<li>
<p>弯曲链，直接将当前节点向上旋转两次</p>
</li>
<li>
<p>也可以看成直接将当前节点往最上面一提，两个儿子被父节点和祖先节点均分，从而趋向平衡</p>
</li>
<li>
<p><img alt="ZigZag" src="../images/ZigZag.png" /></p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>NOTES:</p>
<ul>
<li>Splaying roughly halves the depth of most nodes on the access path. </li>
</ul>
</li>
</ul>
<details class="collapsible">
<summary>Code (Not checked yet)</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Splay Tree</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span>
<span class="normal"><a href="#__codelineno-1-40">40</a></span>
<span class="normal"><a href="#__codelineno-1-41">41</a></span>
<span class="normal"><a href="#__codelineno-1-42">42</a></span>
<span class="normal"><a href="#__codelineno-1-43">43</a></span>
<span class="normal"><a href="#__codelineno-1-44">44</a></span>
<span class="normal"><a href="#__codelineno-1-45">45</a></span>
<span class="normal"><a href="#__codelineno-1-46">46</a></span>
<span class="normal"><a href="#__codelineno-1-47">47</a></span>
<span class="normal"><a href="#__codelineno-1-48">48</a></span>
<span class="normal"><a href="#__codelineno-1-49">49</a></span>
<span class="normal"><a href="#__codelineno-1-50">50</a></span>
<span class="normal"><a href="#__codelineno-1-51">51</a></span>
<span class="normal"><a href="#__codelineno-1-52">52</a></span>
<span class="normal"><a href="#__codelineno-1-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">fa</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Pivot</span><span class="p">)</span><span class="o">:</span><span class="n">data</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">fa</span><span class="p">(</span><span class="n">F</span><span class="p">),</span><span class="n">v</span><span class="p">{</span><span class="n">Pivot</span><span class="p">,</span><span class="w"> </span><span class="n">Pivot</span><span class="p">}{}</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="p">};</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="k">typedef</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Pt</span><span class="p">;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="n">Pt</span><span class="w"> </span><span class="n">NUL</span><span class="p">;</span><span class="c1">// A trick to avoid NULL pointer</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="k">struct</span><span class="w"> </span><span class="nc">SplayTree</span><span class="p">{</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">    </span><span class="n">Pt</span><span class="w"> </span><span class="n">Rot</span><span class="p">;</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Print</span><span class="p">(</span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="c1">// Preorder</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NUL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">        </span><span class="n">Print</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="w"> </span><span class="n">Print</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Is</span><span class="p">(</span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">fa</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="p">);}</span><span class="c1">// 0: left son, 1: right son</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Rotate</span><span class="p">(</span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w"> </span><span class="c1">// Rotate i to its father</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">        </span><span class="n">Pt</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">fa</span><span class="p">,</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">fa</span><span class="p">;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Is</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Is</span><span class="p">(</span><span class="n">F</span><span class="p">);</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">        </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="o">^</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">fa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">;</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">        </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">fa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="o">^</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">;</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="w">        </span><span class="n">G</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">fa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G</span><span class="p">;</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Splay</span><span class="p">(</span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="c1">// Splay i to the root</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">fa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NUL</span><span class="p">){</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">fa</span><span class="o">-&gt;</span><span class="n">fa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NUL</span><span class="p">)</span><span class="w"> </span><span class="n">Rotate</span><span class="p">(</span><span class="n">Is</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Is</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">fa</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">fa</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">Rotate</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="n">Rotate</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">        </span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Insert</span><span class="p">(</span><span class="n">Pt</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">Pt</span><span class="w"> </span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NUL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)(</span><span class="n">Splay</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">NUL</span><span class="p">)));</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="w">        </span><span class="n">Insert</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">],</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="w">    </span><span class="c1">// User Interface</span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Clear</span><span class="p">(){</span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NUL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);}</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Print</span><span class="p">(){</span><span class="n">Print</span><span class="p">(</span><span class="n">Rot</span><span class="p">);</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;}</span>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Insert</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="n">Insert</span><span class="p">(</span><span class="n">Rot</span><span class="p">,</span><span class="w"> </span><span class="n">NUL</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);}</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Find</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a><span class="w">        </span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rot</span><span class="p">;</span>
<a id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NUL</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">];</span>
<a id="__codelineno-1-41" name="__codelineno-1-41"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NUL</span><span class="p">)</span><span class="w"> </span><span class="n">Splay</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-43" name="__codelineno-1-43"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Delete</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-1-44" name="__codelineno-1-44"></a><span class="w">        </span><span class="n">Find</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="c1">// Splay x to the root</span>
<a id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NUL</span><span class="p">)</span><span class="w"> </span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">fa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NUL</span><span class="p">;</span>
<a id="__codelineno-1-46" name="__codelineno-1-46"></a><span class="w">        </span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-1-47" name="__codelineno-1-47"></a><span class="w">            </span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rot</span><span class="p">;</span>
<a id="__codelineno-1-48" name="__codelineno-1-48"></a><span class="w">            </span><span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NUL</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="c1">// Find the maximum in the left subtree</span>
<a id="__codelineno-1-49" name="__codelineno-1-49"></a><span class="w">            </span><span class="n">Splay</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-1-50" name="__codelineno-1-50"></a><span class="w">            </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">X</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">fa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-1-51" name="__codelineno-1-51"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-52" name="__codelineno-1-52"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-53" name="__codelineno-1-53"></a><span class="p">}</span><span class="n">Tree</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</details>
<hr />
<h3 id="b-tree">B+ Tree</h3>
<blockquote>
<p>一种多路搜索树，常用于数据库索引、文件系统等</p>
</blockquote>
<ul>
<li>
<p><strong>特征</strong> （Order of M）</p>
<ul>
<li>
<p>根节点有<span class="arithmatex">\([2,M]\)</span>个子节点</p>
</li>
<li>
<p>其余非叶节点有<span class="arithmatex">\([[\frac{M+1}{2}],M]\)</span>个子节点，用 K - 1 个关键字进行区间划分</p>
</li>
<li>
<p>所有叶节点在同一层，且都在最底层, 且都有<span class="arithmatex">\([[\frac{M+1}{2}],M]\)</span>个关键字</p>
</li>
</ul>
</li>
<li>
<p>优势：</p>
<ul>
<li>
<p>可以看出，B+树的高度非常低，整棵树总体上非常“扁平”，因而查询效率非常高</p>
</li>
<li>
<p>由于叶节点都在同一层，若对兄弟节点间建立指针，可以很方便的进行范围查询</p>
</li>
</ul>
</li>
<li>
<p>维护</p>
<ul>
<li>
<p>插入</p>
<ul>
<li>
<p>从根节点开始，找到合适的叶节点，插入关键字</p>
</li>
<li>
<p>若叶节点关键字数目超过上限，将节点均分为<span class="arithmatex">\([\frac{M+1}{2}],[\frac{M}{2}]\)</span>两部分，并更新划分关键字为右半边的最小值</p>
</li>
<li>
<p>递归向上，若父节点关键字数目超过上限，分裂为<span class="arithmatex">\([\frac{M+1}{2}],[\frac{M}{2}]\)</span>两部分，并更新父节点处关键字为<strong>中间剩余的一个划分关键字</strong></p>
</li>
<li>
<p>若到达根节点，则新建节点，即全树高度加一</p>
</li>
</ul>
</li>
<li>
<p>删除</p>
<ul>
<li>
<p>从根节点开始，找到合适的叶节点，删除关键字</p>
</li>
<li>
<p>若叶节点关键字数目低于下限，找到兄弟节点，若兄弟节点关键字数目大于下限，和兄弟平分节点</p>
</li>
<li>
<p>若兄弟节点关键字数目也低于下限，将当前节点与兄弟节点合并，删除父节点处的一个关键字</p>
</li>
<li>
<p>递归向上，对父节点进行相同操作</p>
</li>
<li>
<p>若到达根节点，且根节点关键字数目为0，删除根节点，即全树高度减一        </p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<details class="collapsible">
<summary>Code (Delete Not Carefully Checked yet)</summary>
<p>我觉得B+树最恶心的一点就在于他的内部节点与叶结点定义的不一致性，导致编写代码非常麻烦（<em>对于我这种具有“统一性写法”强迫症的人来说</em>）</p>
<p>结果就是白白花费数小时去写掺杂着各种 IsLeaf 运算的式子，和无穷无尽的Debug</p>
<p>因此，<strong>惨痛教训：很多时候可以通过简单分类，增加代码长度，大大降低编码复杂度！！！</strong> </p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">B+ Tree</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">  1</a></span>
<span class="normal"><a href="#__codelineno-2-2">  2</a></span>
<span class="normal"><a href="#__codelineno-2-3">  3</a></span>
<span class="normal"><a href="#__codelineno-2-4">  4</a></span>
<span class="normal"><a href="#__codelineno-2-5">  5</a></span>
<span class="normal"><a href="#__codelineno-2-6">  6</a></span>
<span class="normal"><a href="#__codelineno-2-7">  7</a></span>
<span class="normal"><a href="#__codelineno-2-8">  8</a></span>
<span class="normal"><a href="#__codelineno-2-9">  9</a></span>
<span class="normal"><a href="#__codelineno-2-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-2-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-2-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-2-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-2-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-2-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-2-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-2-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-2-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-2-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-2-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-2-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-2-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-2-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-2-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-2-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-2-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-2-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-2-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-2-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-2-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-2-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-2-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-2-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-2-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-2-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-2-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-2-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-2-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-2-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-2-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-2-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-2-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-2-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-2-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-2-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-2-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-2-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-2-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-2-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-2-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-2-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-2-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-2-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-2-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-2-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-2-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-2-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-2-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-2-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-2-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-2-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-2-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-2-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-2-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-2-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-2-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-2-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-2-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-2-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-2-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-2-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-2-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-2-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-2-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-2-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-2-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-2-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-2-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-2-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-2-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-2-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-2-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-2-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-2-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-2-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-2-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-2-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-2-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-2-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-2-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-2-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-2-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-2-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-2-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-2-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-2-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-2-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-2-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-2-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-2-100">100</a></span>
<span class="normal"><a href="#__codelineno-2-101">101</a></span>
<span class="normal"><a href="#__codelineno-2-102">102</a></span>
<span class="normal"><a href="#__codelineno-2-103">103</a></span>
<span class="normal"><a href="#__codelineno-2-104">104</a></span>
<span class="normal"><a href="#__codelineno-2-105">105</a></span>
<span class="normal"><a href="#__codelineno-2-106">106</a></span>
<span class="normal"><a href="#__codelineno-2-107">107</a></span>
<span class="normal"><a href="#__codelineno-2-108">108</a></span>
<span class="normal"><a href="#__codelineno-2-109">109</a></span>
<span class="normal"><a href="#__codelineno-2-110">110</a></span>
<span class="normal"><a href="#__codelineno-2-111">111</a></span>
<span class="normal"><a href="#__codelineno-2-112">112</a></span>
<span class="normal"><a href="#__codelineno-2-113">113</a></span>
<span class="normal"><a href="#__codelineno-2-114">114</a></span>
<span class="normal"><a href="#__codelineno-2-115">115</a></span>
<span class="normal"><a href="#__codelineno-2-116">116</a></span>
<span class="normal"><a href="#__codelineno-2-117">117</a></span>
<span class="normal"><a href="#__codelineno-2-118">118</a></span>
<span class="normal"><a href="#__codelineno-2-119">119</a></span>
<span class="normal"><a href="#__codelineno-2-120">120</a></span>
<span class="normal"><a href="#__codelineno-2-121">121</a></span>
<span class="normal"><a href="#__codelineno-2-122">122</a></span>
<span class="normal"><a href="#__codelineno-2-123">123</a></span>
<span class="normal"><a href="#__codelineno-2-124">124</a></span>
<span class="normal"><a href="#__codelineno-2-125">125</a></span>
<span class="normal"><a href="#__codelineno-2-126">126</a></span>
<span class="normal"><a href="#__codelineno-2-127">127</a></span>
<span class="normal"><a href="#__codelineno-2-128">128</a></span>
<span class="normal"><a href="#__codelineno-2-129">129</a></span>
<span class="normal"><a href="#__codelineno-2-130">130</a></span>
<span class="normal"><a href="#__codelineno-2-131">131</a></span>
<span class="normal"><a href="#__codelineno-2-132">132</a></span>
<span class="normal"><a href="#__codelineno-2-133">133</a></span>
<span class="normal"><a href="#__codelineno-2-134">134</a></span>
<span class="normal"><a href="#__codelineno-2-135">135</a></span>
<span class="normal"><a href="#__codelineno-2-136">136</a></span>
<span class="normal"><a href="#__codelineno-2-137">137</a></span>
<span class="normal"><a href="#__codelineno-2-138">138</a></span>
<span class="normal"><a href="#__codelineno-2-139">139</a></span>
<span class="normal"><a href="#__codelineno-2-140">140</a></span>
<span class="normal"><a href="#__codelineno-2-141">141</a></span>
<span class="normal"><a href="#__codelineno-2-142">142</a></span>
<span class="normal"><a href="#__codelineno-2-143">143</a></span>
<span class="normal"><a href="#__codelineno-2-144">144</a></span>
<span class="normal"><a href="#__codelineno-2-145">145</a></span>
<span class="normal"><a href="#__codelineno-2-146">146</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w">                  </span><span class="c1">//  Number of keys</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Key</span><span class="p">[</span><span class="n">Order</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w">     </span><span class="c1">//  Keys</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="n">Child</span><span class="p">[</span><span class="n">Order</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="c1">//  Children</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Rs</span><span class="p">;</span><span class="w">          </span><span class="c1">//  Left and Right Sibling</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Height</span><span class="p">;</span><span class="w">              </span><span class="c1">//  Height of the node for printing</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">    </span><span class="n">Node</span><span class="p">(){</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">        </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">        </span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">Order</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">Child</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">Key</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Split</span><span class="p">(){</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">();</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">        </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Height</span><span class="p">;</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">        </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rs</span><span class="p">,</span><span class="w"> </span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Height</span><span class="p">){</span><span class="w"> </span><span class="c1">// Internal Node</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">                </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">j</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">j</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Child</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">                </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">M</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">            </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">j</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Child</span><span class="p">[</span><span class="n">M</span><span class="p">],</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w">  </span><span class="c1">// Leaf Node</span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">j</span><span class="o">-&gt;</span><span class="n">M</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="w">            </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="p">};</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="kt">int</span><span class="w"> </span><span class="n">tp</span><span class="p">[</span><span class="n">Order</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">tq</span><span class="p">[</span><span class="n">Order</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a><span class="k">struct</span><span class="w"> </span><span class="nc">BpTree</span><span class="p">{</span>
<a id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Rot</span><span class="p">;</span>
<a id="__codelineno-2-33" name="__codelineno-2-33"></a><span class="w">    </span><span class="cp">#define IsLeaf(x) ((x)-&gt;Height == 0)</span>
<a id="__codelineno-2-34" name="__codelineno-2-34"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Insert</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-2-35" name="__codelineno-2-35"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<a id="__codelineno-2-36" name="__codelineno-2-36"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">IsLeaf</span><span class="p">(</span><span class="n">i</span><span class="p">)){</span><span class="c1">// Leaf Node can contain more keys</span>
<a id="__codelineno-2-37" name="__codelineno-2-37"></a><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)(</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Key %d is duplicated</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">));</span>
<a id="__codelineno-2-38" name="__codelineno-2-38"></a><span class="w">            </span><span class="k">while</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">k</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-2-39" name="__codelineno-2-39"></a><span class="w">            </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-2-40" name="__codelineno-2-40"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-2-41" name="__codelineno-2-41"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a><span class="w">        </span><span class="c1">// search for the child to insert</span>
<a id="__codelineno-2-44" name="__codelineno-2-44"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-2-45" name="__codelineno-2-45"></a><span class="w">        </span><span class="n">Insert</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-2-46" name="__codelineno-2-46"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">IsLeaf</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Order</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-2-47" name="__codelineno-2-47"></a>
<a id="__codelineno-2-48" name="__codelineno-2-48"></a><span class="w">        </span><span class="c1">// split the child</span>
<a id="__codelineno-2-49" name="__codelineno-2-49"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Split</span><span class="p">();</span>
<a id="__codelineno-2-50" name="__codelineno-2-50"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">k</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">t</span><span class="p">],</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">t</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-2-51" name="__codelineno-2-51"></a><span class="w">        </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">],</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-2-52" name="__codelineno-2-52"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-53" name="__codelineno-2-53"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetChild</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="p">){</span>
<a id="__codelineno-2-54" name="__codelineno-2-54"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">F</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<a id="__codelineno-2-55" name="__codelineno-2-55"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-2-56" name="__codelineno-2-56"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-57" name="__codelineno-2-57"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Delete</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-2-58" name="__codelineno-2-58"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<a id="__codelineno-2-59" name="__codelineno-2-59"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">IsLeaf</span><span class="p">(</span><span class="n">i</span><span class="p">)){</span>
<a id="__codelineno-2-60" name="__codelineno-2-60"></a><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-2-61" name="__codelineno-2-61"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-2-62" name="__codelineno-2-62"></a><span class="w">            </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-2-63" name="__codelineno-2-63"></a><span class="w">            </span><span class="k">for</span><span class="p">(;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-2-64" name="__codelineno-2-64"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-2-65" name="__codelineno-2-65"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-66" name="__codelineno-2-66"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-2-67" name="__codelineno-2-67"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="w"> </span><span class="o">*</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-2-68" name="__codelineno-2-68"></a><span class="w">        </span><span class="n">Delete</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-2-69" name="__codelineno-2-69"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">IsLeaf</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-2-70" name="__codelineno-2-70"></a>
<a id="__codelineno-2-71" name="__codelineno-2-71"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="n">swap</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">),</span><span class="w"> </span><span class="n">k</span><span class="o">--</span><span class="p">;</span><span class="c1">// s --&gt; t</span>
<a id="__codelineno-2-72" name="__codelineno-2-72"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">IsLeaf</span><span class="p">(</span><span class="n">s</span><span class="p">)){</span><span class="w"> </span><span class="c1">// cope with leaf node</span>
<a id="__codelineno-2-73" name="__codelineno-2-73"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">Order</span><span class="p">){</span><span class="c1">// Borrow from sibling</span>
<a id="__codelineno-2-74" name="__codelineno-2-74"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-75" name="__codelineno-2-75"></a><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">tp</span><span class="p">[</span><span class="o">++</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-2-76" name="__codelineno-2-76"></a><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">tp</span><span class="p">[</span><span class="o">++</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="c1">//merge together</span>
<a id="__codelineno-2-77" name="__codelineno-2-77"></a>
<a id="__codelineno-2-78" name="__codelineno-2-78"></a><span class="w">                </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-79" name="__codelineno-2-79"></a><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cnt</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tp</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="c1">//average</span>
<a id="__codelineno-2-80" name="__codelineno-2-80"></a><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tp</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-2-81" name="__codelineno-2-81"></a><span class="w">                </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-2-82" name="__codelineno-2-82"></a><span class="w">            </span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w"> </span><span class="c1">// merge leaf</span>
<a id="__codelineno-2-83" name="__codelineno-2-83"></a><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-2-84" name="__codelineno-2-84"></a><span class="w">                </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-2-85" name="__codelineno-2-85"></a><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-2-86" name="__codelineno-2-86"></a><span class="w">                </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">;</span>
<a id="__codelineno-2-87" name="__codelineno-2-87"></a><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a id="__codelineno-2-88" name="__codelineno-2-88"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-89" name="__codelineno-2-89"></a><span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-2-90" name="__codelineno-2-90"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">Order</span><span class="p">){</span><span class="c1">// Borrow from sibling(average with sibling)</span>
<a id="__codelineno-2-91" name="__codelineno-2-91"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-92" name="__codelineno-2-92"></a><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">tp</span><span class="p">[</span><span class="o">++</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="w"> </span><span class="n">tq</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-2-93" name="__codelineno-2-93"></a><span class="w">                </span><span class="n">tp</span><span class="p">[</span><span class="o">++</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="w"> </span><span class="n">tq</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">];</span>
<a id="__codelineno-2-94" name="__codelineno-2-94"></a><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">tp</span><span class="p">[</span><span class="o">++</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="w"> </span><span class="n">tq</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-2-95" name="__codelineno-2-95"></a><span class="w">                </span><span class="n">tq</span><span class="p">[</span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">];</span><span class="c1">//merge together</span>
<a id="__codelineno-2-96" name="__codelineno-2-96"></a>
<a id="__codelineno-2-97" name="__codelineno-2-97"></a><span class="w">                </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-98" name="__codelineno-2-98"></a><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cnt</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tp</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tq</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-2-99" name="__codelineno-2-99"></a><span class="w">                </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tq</span><span class="p">[</span><span class="n">cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-2-100" name="__codelineno-2-100"></a><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tp</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tq</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-2-101" name="__codelineno-2-101"></a><span class="w">                </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tq</span><span class="p">[</span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="c1">//average</span>
<a id="__codelineno-2-102" name="__codelineno-2-102"></a><span class="w">                </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tp</span><span class="p">[</span><span class="n">cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-2-103" name="__codelineno-2-103"></a><span class="w">            </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-2-104" name="__codelineno-2-104"></a><span class="w">                </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
<a id="__codelineno-2-105" name="__codelineno-2-105"></a><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="o">++</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-2-106" name="__codelineno-2-106"></a><span class="w">                </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="o">++</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">];</span>
<a id="__codelineno-2-107" name="__codelineno-2-107"></a><span class="w">                </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-2-108" name="__codelineno-2-108"></a><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-2-109" name="__codelineno-2-109"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-110" name="__codelineno-2-110"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-111" name="__codelineno-2-111"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-112" name="__codelineno-2-112"></a>
<a id="__codelineno-2-113" name="__codelineno-2-113"></a><span class="w">    </span><span class="c1">// interface for user</span>
<a id="__codelineno-2-114" name="__codelineno-2-114"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Clear</span><span class="p">(){</span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">();}</span>
<a id="__codelineno-2-115" name="__codelineno-2-115"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Insert</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-2-116" name="__codelineno-2-116"></a><span class="w">        </span><span class="n">Insert</span><span class="p">(</span><span class="n">Rot</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-2-117" name="__codelineno-2-117"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rot</span><span class="p">;</span>
<a id="__codelineno-2-118" name="__codelineno-2-118"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">IsLeaf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">Order</span><span class="p">){</span><span class="c1">// Split the root if necessary</span>
<a id="__codelineno-2-119" name="__codelineno-2-119"></a><span class="w">            </span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">();</span>
<a id="__codelineno-2-120" name="__codelineno-2-120"></a><span class="w">            </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Split</span><span class="p">();</span>
<a id="__codelineno-2-121" name="__codelineno-2-121"></a><span class="w">            </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">],</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
<a id="__codelineno-2-122" name="__codelineno-2-122"></a><span class="w">            </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Height</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-2-123" name="__codelineno-2-123"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-124" name="__codelineno-2-124"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-125" name="__codelineno-2-125"></a>
<a id="__codelineno-2-126" name="__codelineno-2-126"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Delete</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-2-127" name="__codelineno-2-127"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Rot</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">(</span><span class="kt">void</span><span class="p">)(</span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;Empty&quot;</span><span class="p">));</span>
<a id="__codelineno-2-128" name="__codelineno-2-128"></a><span class="w">        </span><span class="n">Delete</span><span class="p">(</span><span class="n">Rot</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-2-129" name="__codelineno-2-129"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-2-130" name="__codelineno-2-130"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-131" name="__codelineno-2-131"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Print</span><span class="p">(){</span><span class="c1">// BFS</span>
<a id="__codelineno-2-132" name="__codelineno-2-132"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Rot</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)(</span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;Empty&quot;</span><span class="p">));</span>
<a id="__codelineno-2-133" name="__codelineno-2-133"></a><span class="w">        </span><span class="n">queue</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">Q</span><span class="p">;</span>
<a id="__codelineno-2-134" name="__codelineno-2-134"></a><span class="w">        </span><span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Rot</span><span class="p">);</span>
<a id="__codelineno-2-135" name="__codelineno-2-135"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">lst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">Height</span><span class="p">;</span>
<a id="__codelineno-2-136" name="__codelineno-2-136"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">Q</span><span class="p">.</span><span class="n">empty</span><span class="p">()){</span>
<a id="__codelineno-2-137" name="__codelineno-2-137"></a><span class="w">            </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="p">.</span><span class="n">front</span><span class="p">();</span><span class="w"> </span><span class="n">Q</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-2-138" name="__codelineno-2-138"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">Height</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">lst</span><span class="p">)</span><span class="w"> </span><span class="n">putchar</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">lst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">-&gt;</span><span class="n">Height</span><span class="p">;</span>
<a id="__codelineno-2-139" name="__codelineno-2-139"></a><span class="w">            </span><span class="n">putchar</span><span class="p">(</span><span class="sc">&#39;[&#39;</span><span class="p">);</span>
<a id="__codelineno-2-140" name="__codelineno-2-140"></a><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">x</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-2-141" name="__codelineno-2-141"></a><span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d]&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">[</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-2-142" name="__codelineno-2-142"></a><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">x</span><span class="o">-&gt;</span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">Child</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-2-143" name="__codelineno-2-143"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-144" name="__codelineno-2-144"></a><span class="w">        </span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
<a id="__codelineno-2-145" name="__codelineno-2-145"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-146" name="__codelineno-2-146"></a><span class="p">}</span><span class="n">B</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</details>
<hr />
<h3 id="rb-tree">RB Tree</h3>
<p><em>第二节课就讲手撕红黑树 &amp; B+树，这就是ZJU的ADS, 恐怖如斯……</em></p>
<blockquote>
<p>一种自平衡二叉查找树，常用于C++ STL中的set和map，以及Linux内核中的进程调度等</p>
<p>效率较高且比一般平衡树稳定，但实现……</p>
</blockquote>
<ul>
<li>
<p><strong>特征（熟记？！）</strong></p>
<ol>
<li>
<p>每个节点要么是红色，要么是黑色</p>
</li>
<li>
<p>根节点是黑色</p>
</li>
<li>
<p>每个叶节点都为NIL节点，且为黑色</p>
</li>
<li>
<p>不能有两个相邻的红色节点</p>
</li>
<li>
<p>从任一节点到其每个叶节点的所有路径都包含相同数目的黑色节点<em>（也正是基于此我们定义了树的黑高）</em></p>
</li>
</ol>
</li>
<li>
<p><strong>复杂度分析</strong></p>
<table>
<thead>
<tr>
<th>operation</th>
<th>complexity</th>
<th>rotation</th>
<th>recoloring</th>
</tr>
</thead>
<tbody>
<tr>
<td>Insert</td>
<td>O(logN)</td>
<td>O(1)</td>
<td>O(logN)</td>
</tr>
<tr>
<td>Delete</td>
<td>O(logN)</td>
<td>O(1)</td>
<td>O(logN)</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>常见操作均为<span class="arithmatex">\(O(logN)\)</span></p>
</li>
<li>
<p>维护的旋转次数为常数时间，所以非常快 </p>
</li>
</ul>
<blockquote>
<p>首先定义黑高 bh(x) 为从节点 x 到其每个叶节点的简单路径上黑色节点数目（不包括自己）</p>
</blockquote>
<ul>
<li>
<p>证明：</p>
<ul>
<li>
<p>首先，由红黑树定义，<span class="arithmatex">\(h(x) &lt;= 2bh(x)\)</span></p>
</li>
<li>
<p>使用数学归纳法，对于任意节点 x，其子树的节点数目 <span class="arithmatex">\(N(x) &gt;= 2^{bh(x)} - 1\)</span></p>
<ul>
<li>
<p>因为对于任意节点，其子节点的黑高为 bh(x) 或 bh(x) - 1</p>
</li>
<li>
<p>从而由归纳假设，有 <span class="arithmatex">\(N(x) &gt;= 2^{bh(x) - 1} - 1 + 2^{bh(x) - 1} - 1 + 1 = 2^{bh(x)} - 1\)</span></p>
</li>
</ul>
</li>
<li>
<p>综上，得证     </p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>维护</strong></p>
<p><em>主要参考了算法导论，感觉相对于课件，将子树的分布画出来，更加清晰明了一些</em></p>
<ul>
<li>
<p><strong>我觉得，本质上插入和删除最关注的还是黑高的维护，因此关键步骤都是在调整树的形态的同时，如何对黑高不产生影响</strong></p>
<ul>
<li>
<p>基于同高度同时变化的不变</p>
<ul>
<li>
<p>黑下放：将黑色节点的两个红色儿子变为黑色，自己变为红色</p>
</li>
<li>
<p>黑上提：将两黑色儿子的黑色汇聚到红色的父亲身上，儿子变红 </p>
</li>
</ul>
</li>
<li>
<p>旋转不变</p>
<ul>
<li>
<p>在旋转时，若下方待转节点为红色，则旋转后继承其原本父节点的颜色，原本父节点变红，黑高不变</p>
</li>
<li>
<p>特别的，红节点转来转去并不会对黑高产生影响   </p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>插入 </p>
<ul>
<li>按正常二叉排序树的方式，插入一个红色节点 —— 此时不会影响黑高，但可能出现两个相邻的红色节点，从而需要进行调整</li>
</ul>
<p><em>（插入黑色节点会对到根整条路径产生破坏，更加难调整）</em></p>
<ul>
<li>
<p>简单情况：父节点为黑色，不需要调整</p>
</li>
<li>
<p><strong>复杂情况：父节点为红色，插入主要关注“叔”节点</strong>（z为当前节点，y为叔节点）</p>
<ul>
<li>
<p>Case 1</p>
<ul>
<li>叔节点为红色，则祖父节点必为黑色，那么实行一次“黑下放”操作，将祖父节点的黑色向下传递到其子节点，自己变为红色即可</li>
</ul>
<p><img alt="Insert1" src="../images/insert1.png" /></p>
</li>
<li>
<p>Case 2 &amp; Case 3</p>
<ul>
<li>
<p>Case 2, 叔节点为当前节点的同侧节点，则可以通过当前节点的一次旋转，变为异侧的情况（此时 z 变成原来的父节点了）</p>
</li>
<li>
<p>Case 3, 叔节点为当前节点的异侧节点，而父节点为红色，可以通过一次上述的不变旋转完成调整</p>
</li>
<li>
<p><em>从结果来看，实际上是非常好理解的，本质上就是下图中 A &lt; B &lt; C, 从而应将B旋转到最中央，使平衡树尽可能平衡</em> </p>
</li>
</ul>
<p><img alt="Insert2&amp;3" src="../images/insert2_3.png" />    </p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>删除 </p>
<ul>
<li>
<p>和一般的二叉查找树一样，先用节点的前驱/后继节点替换（颜色不变），然后删除前驱/后继节点</p>
</li>
<li>
<p>这样可能会导致删除了黑色节点影响黑高，或者出现两个相邻的红色节点</p>
</li>
<li>
<p>简单情况：删除的节点为红色，不会产生影响，不需要调整</p>
</li>
<li>
<p><strong>复杂情况：删除了黑色节点，影响很大，会导致多个特征不符合</strong></p>
<p><strong>本质上，就是导致了替换节点 x 这颗子树的黑高都偏少了1, 所以接下来就是讨论如何优雅地将他们全部+1</strong></p>
<p>下面讨论替换节点 x 为黑色的情况（红色的话直接染黑即可，还可以顺便避免相邻红色节点），<strong>删除主要关注兄弟节点 w</strong> </p>
<ul>
<li>
<p>Case 1</p>
<ul>
<li>兄弟节点为红色，则进行一次上述的不变旋转，将兄弟节点变为黑色，父节点变为红色（红节点上方下方，原来必黑），转化为下面要讨论的情形</li>
</ul>
<p><img alt="Delete1" src="../images/delete1.png" /></p>
</li>
<li>
<p>Case 2</p>
<ul>
<li>兄弟节点为黑色，且兄弟节点的两个儿子都为黑色, 则干脆将兄弟节点变为红色，这样当前节点和兄弟节点的子树相当于“扯平”了都差1，从而可以向上递归调整，即当前待调整节点变为父节点</li>
</ul>
<p><img alt="Delete2" src="../images/delete2.png" /></p>
</li>
<li>
<p>Case 3</p>
<ul>
<li>兄弟节点为黑色，且兄弟节点的异侧子节点为黑色，同侧子节点为红色，此时可以通过一次不变旋转，将该红色节点变为黑色兄弟，并获得异侧子节点，转化为Case 4</li>
</ul>
<p><img alt="Delete3" src="../images/delete3.png" /> </p>
</li>
<li>
<p>Case 4</p>
<ul>
<li>兄弟节点为黑色，且兄弟节点的异侧子节点为红色，此时将父节点旋转下来强制染黑来补偿子树黑高，兄弟节点旋转到上方并继承父节点的颜色，<strong>并将剩下的一个儿子也染黑</strong>，维护其余子树的黑高不变，直接Over（可以检查每颗子树所经过的路径，恰好完美符合，<strong>过于巧妙！</strong>）</li>
</ul>
<p><img alt="Delete4" src="../images/delete4.png" />   </p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><em>上面提到的都是自底向上调整的方法，还有一种自顶向下的办法，即在用循环插入/寻找关键字的同时对树的形态进行维护和调整，使得插入/删除后树的形态直接满足要求，这种方法会跑得更快一点</em></p>
</li>
</ul>
</li>
</ul>
<details class="collapsible">
<summary>Code</summary>
<p><em>面向Luogu P3369平衡树模板题写的，跑得嘎嘎快，这就是RBTree! 但是花了我一下午debug！！！</em></p>
<p><strong>主要注意空节点的一些处理（提前将对应指针记下来防止后面被更改），以及及时更新根节点的指针</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Red Black Tree</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">  1</a></span>
<span class="normal"><a href="#__codelineno-3-2">  2</a></span>
<span class="normal"><a href="#__codelineno-3-3">  3</a></span>
<span class="normal"><a href="#__codelineno-3-4">  4</a></span>
<span class="normal"><a href="#__codelineno-3-5">  5</a></span>
<span class="normal"><a href="#__codelineno-3-6">  6</a></span>
<span class="normal"><a href="#__codelineno-3-7">  7</a></span>
<span class="normal"><a href="#__codelineno-3-8">  8</a></span>
<span class="normal"><a href="#__codelineno-3-9">  9</a></span>
<span class="normal"><a href="#__codelineno-3-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-3-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-3-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-3-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-3-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-3-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-3-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-3-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-3-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-3-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-3-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-3-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-3-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-3-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-3-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-3-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-3-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-3-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-3-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-3-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-3-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-3-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-3-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-3-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-3-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-3-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-3-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-3-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-3-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-3-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-3-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-3-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-3-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-3-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-3-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-3-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-3-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-3-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-3-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-3-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-3-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-3-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-3-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-3-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-3-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-3-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-3-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-3-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-3-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-3-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-3-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-3-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-3-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-3-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-3-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-3-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-3-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-3-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-3-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-3-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-3-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-3-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-3-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-3-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-3-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-3-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-3-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-3-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-3-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-3-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-3-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-3-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-3-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-3-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-3-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-3-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-3-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-3-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-3-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-3-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-3-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-3-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-3-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-3-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-3-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-3-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-3-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-3-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-3-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-3-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-3-100">100</a></span>
<span class="normal"><a href="#__codelineno-3-101">101</a></span>
<span class="normal"><a href="#__codelineno-3-102">102</a></span>
<span class="normal"><a href="#__codelineno-3-103">103</a></span>
<span class="normal"><a href="#__codelineno-3-104">104</a></span>
<span class="normal"><a href="#__codelineno-3-105">105</a></span>
<span class="normal"><a href="#__codelineno-3-106">106</a></span>
<span class="normal"><a href="#__codelineno-3-107">107</a></span>
<span class="normal"><a href="#__codelineno-3-108">108</a></span>
<span class="normal"><a href="#__codelineno-3-109">109</a></span>
<span class="normal"><a href="#__codelineno-3-110">110</a></span>
<span class="normal"><a href="#__codelineno-3-111">111</a></span>
<span class="normal"><a href="#__codelineno-3-112">112</a></span>
<span class="normal"><a href="#__codelineno-3-113">113</a></span>
<span class="normal"><a href="#__codelineno-3-114">114</a></span>
<span class="normal"><a href="#__codelineno-3-115">115</a></span>
<span class="normal"><a href="#__codelineno-3-116">116</a></span>
<span class="normal"><a href="#__codelineno-3-117">117</a></span>
<span class="normal"><a href="#__codelineno-3-118">118</a></span>
<span class="normal"><a href="#__codelineno-3-119">119</a></span>
<span class="normal"><a href="#__codelineno-3-120">120</a></span>
<span class="normal"><a href="#__codelineno-3-121">121</a></span>
<span class="normal"><a href="#__codelineno-3-122">122</a></span>
<span class="normal"><a href="#__codelineno-3-123">123</a></span>
<span class="normal"><a href="#__codelineno-3-124">124</a></span>
<span class="normal"><a href="#__codelineno-3-125">125</a></span>
<span class="normal"><a href="#__codelineno-3-126">126</a></span>
<span class="normal"><a href="#__codelineno-3-127">127</a></span>
<span class="normal"><a href="#__codelineno-3-128">128</a></span>
<span class="normal"><a href="#__codelineno-3-129">129</a></span>
<span class="normal"><a href="#__codelineno-3-130">130</a></span>
<span class="normal"><a href="#__codelineno-3-131">131</a></span>
<span class="normal"><a href="#__codelineno-3-132">132</a></span>
<span class="normal"><a href="#__codelineno-3-133">133</a></span>
<span class="normal"><a href="#__codelineno-3-134">134</a></span>
<span class="normal"><a href="#__codelineno-3-135">135</a></span>
<span class="normal"><a href="#__codelineno-3-136">136</a></span>
<span class="normal"><a href="#__codelineno-3-137">137</a></span>
<span class="normal"><a href="#__codelineno-3-138">138</a></span>
<span class="normal"><a href="#__codelineno-3-139">139</a></span>
<span class="normal"><a href="#__codelineno-3-140">140</a></span>
<span class="normal"><a href="#__codelineno-3-141">141</a></span>
<span class="normal"><a href="#__codelineno-3-142">142</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">INF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e9</span><span class="p">;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="k">enum</span><span class="w"> </span><span class="nc">Color</span><span class="w"> </span><span class="p">{</span><span class="n">RED</span><span class="p">,</span><span class="w"> </span><span class="n">BLACK</span><span class="p">};</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="p">{</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="c1">// size denotes the number of nodes in subtree x</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">    </span><span class="n">Color</span><span class="w"> </span><span class="n">color</span><span class="p">;</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="o">*</span><span class="n">F</span><span class="p">;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="n">Node</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLACK</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">fa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">NIL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">){</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">        </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fa</span><span class="p">;</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">        </span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NIL</span><span class="p">;</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Update</span><span class="p">(){</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;}</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="p">};</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="k">typedef</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Pt</span><span class="p">;</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="n">Pt</span><span class="w"> </span><span class="n">NIL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="n">BLACK</span><span class="p">,</span><span class="w"> </span><span class="n">NIL</span><span class="p">,</span><span class="w"> </span><span class="n">NIL</span><span class="p">);</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="k">struct</span><span class="w"> </span><span class="nc">RBTree</span><span class="p">{</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Rot</span><span class="p">;</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="w">    </span><span class="cp">#define Is(i) ((i)-&gt;F-&gt;v[1] == (i))</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Rotate</span><span class="p">(</span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w"> </span><span class="c1">// Rotate i to i-&gt;F</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="w">        </span><span class="n">Pt</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">F</span><span class="p">;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Is</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Is</span><span class="p">(</span><span class="n">F</span><span class="p">);</span>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="w">        </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">;</span><span class="c1">// first cope with external nodes</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="w">        </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">F</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">               </span><span class="c1">// then i and F</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="w">        </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">;</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="w">        </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">Update</span><span class="p">(),</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Update</span><span class="p">();</span>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">F</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Rot</span><span class="p">)</span><span class="w"> </span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">FixUp_Insert</span><span class="p">(</span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="p">){</span>
<a id="__codelineno-3-27" name="__codelineno-3-27"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">F</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">RED</span><span class="p">){</span>
<a id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="w">            </span><span class="kt">bool</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Is</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Is</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">F</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="w">            </span><span class="n">Pt</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">F</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">q</span><span class="p">];</span>
<a id="__codelineno-3-30" name="__codelineno-3-30"></a>
<a id="__codelineno-3-31" name="__codelineno-3-31"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">U</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">RED</span><span class="p">){</span><span class="w"> </span><span class="c1">// case 1: uncle is red, black down</span>
<a id="__codelineno-3-32" name="__codelineno-3-32"></a><span class="w">                </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLACK</span><span class="p">;</span>
<a id="__codelineno-3-33" name="__codelineno-3-33"></a><span class="w">                </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">F</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RED</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">F</span><span class="p">;</span>
<a id="__codelineno-3-34" name="__codelineno-3-34"></a><span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-3-35" name="__codelineno-3-35"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-3-36" name="__codelineno-3-36"></a>
<a id="__codelineno-3-37" name="__codelineno-3-37"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">q</span><span class="p">){</span><span class="w"> </span><span class="c1">// case 2: uncle is black but same side, rotate to case 3</span>
<a id="__codelineno-3-38" name="__codelineno-3-38"></a><span class="w">                </span><span class="n">Rotate</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-3-39" name="__codelineno-3-39"></a><span class="w">                </span><span class="n">swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">),</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-3-40" name="__codelineno-3-40"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-3-41" name="__codelineno-3-41"></a>
<a id="__codelineno-3-42" name="__codelineno-3-42"></a><span class="w">            </span><span class="c1">// case 3: uncle is black and different side, rotate and recolor</span>
<a id="__codelineno-3-43" name="__codelineno-3-43"></a><span class="w">            </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLACK</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">F</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RED</span><span class="p">;</span>
<a id="__codelineno-3-44" name="__codelineno-3-44"></a><span class="w">            </span><span class="n">Rotate</span><span class="p">(</span><span class="n">F</span><span class="p">);</span>
<a id="__codelineno-3-45" name="__codelineno-3-45"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-3-46" name="__codelineno-3-46"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-3-47" name="__codelineno-3-47"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-48" name="__codelineno-3-48"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Insert</span><span class="p">(</span><span class="n">Pt</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">Pt</span><span class="w"> </span><span class="n">fa</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-3-49" name="__codelineno-3-49"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NIL</span><span class="p">){</span>
<a id="__codelineno-3-50" name="__codelineno-3-50"></a><span class="w">            </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">RED</span><span class="p">,</span><span class="w"> </span><span class="n">fa</span><span class="p">,</span><span class="w"> </span><span class="n">NIL</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-3-51" name="__codelineno-3-51"></a><span class="w">            </span><span class="n">FixUp_Insert</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-3-52" name="__codelineno-3-52"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-3-53" name="__codelineno-3-53"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-3-54" name="__codelineno-3-54"></a><span class="w">        </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">size</span><span class="o">++</span><span class="p">,</span><span class="w"> </span><span class="n">Insert</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">],</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-3-55" name="__codelineno-3-55"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-56" name="__codelineno-3-56"></a><span class="w">    </span><span class="n">Pt</span><span class="w"> </span><span class="nf">Find</span><span class="p">(</span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-3-57" name="__codelineno-3-57"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NIL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">NIL</span><span class="p">;</span>
<a id="__codelineno-3-58" name="__codelineno-3-58"></a><span class="w">        </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">size</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-3-59" name="__codelineno-3-59"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-3-60" name="__codelineno-3-60"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Find</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">],</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-3-61" name="__codelineno-3-61"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-62" name="__codelineno-3-62"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">FixUp_Delete</span><span class="p">(</span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="p">){</span>
<a id="__codelineno-3-63" name="__codelineno-3-63"></a><span class="w">        </span><span class="c1">// Print();</span>
<a id="__codelineno-3-64" name="__codelineno-3-64"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">Rot</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BLACK</span><span class="p">){</span>
<a id="__codelineno-3-65" name="__codelineno-3-65"></a><span class="w">            </span><span class="kt">bool</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Is</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-3-66" name="__codelineno-3-66"></a><span class="w">            </span><span class="n">Pt</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-3-67" name="__codelineno-3-67"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">S</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">RED</span><span class="p">){</span><span class="w"> </span><span class="c1">// case 1: sibling is red</span>
<a id="__codelineno-3-68" name="__codelineno-3-68"></a><span class="w">                </span><span class="n">S</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLACK</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RED</span><span class="p">;</span>
<a id="__codelineno-3-69" name="__codelineno-3-69"></a><span class="w">                </span><span class="n">Rotate</span><span class="p">(</span><span class="n">S</span><span class="p">);</span>
<a id="__codelineno-3-70" name="__codelineno-3-70"></a><span class="w">                </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-3-71" name="__codelineno-3-71"></a><span class="w">                </span><span class="c1">// if(S == NIL) assert(i != NIL);</span>
<a id="__codelineno-3-72" name="__codelineno-3-72"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-3-73" name="__codelineno-3-73"></a>
<a id="__codelineno-3-74" name="__codelineno-3-74"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">S</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BLACK</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">S</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BLACK</span><span class="p">){</span><span class="w"> </span><span class="c1">// case 2: sibling is black and both children are black</span>
<a id="__codelineno-3-75" name="__codelineno-3-75"></a><span class="w">                </span><span class="n">S</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RED</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">;</span>
<a id="__codelineno-3-76" name="__codelineno-3-76"></a><span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-3-77" name="__codelineno-3-77"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-3-78" name="__codelineno-3-78"></a>
<a id="__codelineno-3-79" name="__codelineno-3-79"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">S</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BLACK</span><span class="p">){</span><span class="w"> </span><span class="c1">// case 3: sibling is black and the child in the opposite side is black</span>
<a id="__codelineno-3-80" name="__codelineno-3-80"></a><span class="w">                </span><span class="n">S</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLACK</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RED</span><span class="p">;</span>
<a id="__codelineno-3-81" name="__codelineno-3-81"></a><span class="w">                </span><span class="n">Rotate</span><span class="p">(</span><span class="n">S</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span><span class="c1">// rotate to case 4</span>
<a id="__codelineno-3-82" name="__codelineno-3-82"></a><span class="w">                </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-3-83" name="__codelineno-3-83"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-3-84" name="__codelineno-3-84"></a>
<a id="__codelineno-3-85" name="__codelineno-3-85"></a><span class="w">            </span><span class="c1">// case 4: sibling is black and the child in the opposite side is red</span>
<a id="__codelineno-3-86" name="__codelineno-3-86"></a><span class="w">            </span><span class="n">S</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLACK</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLACK</span><span class="p">;</span>
<a id="__codelineno-3-87" name="__codelineno-3-87"></a><span class="w">            </span><span class="n">Rotate</span><span class="p">(</span><span class="n">S</span><span class="p">);</span>
<a id="__codelineno-3-88" name="__codelineno-3-88"></a><span class="w">            </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rot</span><span class="p">;</span>
<a id="__codelineno-3-89" name="__codelineno-3-89"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-3-90" name="__codelineno-3-90"></a><span class="w">        </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLACK</span><span class="p">;</span>
<a id="__codelineno-3-91" name="__codelineno-3-91"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-92" name="__codelineno-3-92"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">Rank</span><span class="p">(</span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-3-93" name="__codelineno-3-93"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NIL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-3-94" name="__codelineno-3-94"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Rank</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-3-95" name="__codelineno-3-95"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Rank</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-3-96" name="__codelineno-3-96"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-97" name="__codelineno-3-97"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">Kth</span><span class="p">(</span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">){</span>
<a id="__codelineno-3-98" name="__codelineno-3-98"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-3-99" name="__codelineno-3-99"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Kth</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-3-100" name="__codelineno-3-100"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Kth</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">k</span><span class="p">);</span>
<a id="__codelineno-3-101" name="__codelineno-3-101"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-102" name="__codelineno-3-102"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">Pre</span><span class="p">(</span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-3-103" name="__codelineno-3-103"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NIL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="n">INF</span><span class="p">;</span>
<a id="__codelineno-3-104" name="__codelineno-3-104"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">Pre</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x</span><span class="p">));</span>
<a id="__codelineno-3-105" name="__codelineno-3-105"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Pre</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-3-106" name="__codelineno-3-106"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-107" name="__codelineno-3-107"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">Next</span><span class="p">(</span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-3-108" name="__codelineno-3-108"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NIL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">INF</span><span class="p">;</span>
<a id="__codelineno-3-109" name="__codelineno-3-109"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">Next</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x</span><span class="p">));</span>
<a id="__codelineno-3-110" name="__codelineno-3-110"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Next</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-3-111" name="__codelineno-3-111"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-112" name="__codelineno-3-112"></a>
<a id="__codelineno-3-113" name="__codelineno-3-113"></a><span class="w">    </span><span class="c1">// interface for user</span>
<a id="__codelineno-3-114" name="__codelineno-3-114"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Clear</span><span class="p">(){</span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NIL</span><span class="p">;}</span>
<a id="__codelineno-3-115" name="__codelineno-3-115"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Insert</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-3-116" name="__codelineno-3-116"></a><span class="w">        </span><span class="n">Insert</span><span class="p">(</span><span class="n">Rot</span><span class="p">,</span><span class="w"> </span><span class="n">NIL</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-3-117" name="__codelineno-3-117"></a><span class="w">        </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLACK</span><span class="p">;</span>
<a id="__codelineno-3-118" name="__codelineno-3-118"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-119" name="__codelineno-3-119"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Delete</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-3-120" name="__codelineno-3-120"></a><span class="w">        </span><span class="n">Pt</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Find</span><span class="p">(</span><span class="n">Rot</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-3-121" name="__codelineno-3-121"></a><span class="w">        </span><span class="n">Color</span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">color</span><span class="p">;</span><span class="c1">// deleted color</span>
<a id="__codelineno-3-122" name="__codelineno-3-122"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NIL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-3-123" name="__codelineno-3-123"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NIL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NIL</span><span class="p">){</span><span class="w"> </span><span class="c1">// i has at most one child</span>
<a id="__codelineno-3-124" name="__codelineno-3-124"></a><span class="w">            </span><span class="kt">bool</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NIL</span><span class="p">);</span>
<a id="__codelineno-3-125" name="__codelineno-3-125"></a><span class="w">            </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">F</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">Is</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
<a id="__codelineno-3-126" name="__codelineno-3-126"></a><span class="w">            </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
<a id="__codelineno-3-127" name="__codelineno-3-127"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">F</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NIL</span><span class="p">)</span><span class="w"> </span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-3-128" name="__codelineno-3-128"></a><span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-3-129" name="__codelineno-3-129"></a><span class="w">            </span><span class="n">Pt</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="n">j</span><span class="o">-&gt;</span><span class="n">size</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-3-130" name="__codelineno-3-130"></a><span class="w">            </span><span class="k">while</span><span class="p">(</span><span class="n">j</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NIL</span><span class="p">)</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">size</span><span class="o">--</span><span class="p">;</span><span class="c1">// maximum in left subtree</span>
<a id="__codelineno-3-131" name="__codelineno-3-131"></a>
<a id="__codelineno-3-132" name="__codelineno-3-132"></a><span class="w">            </span><span class="n">dc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">color</span><span class="p">;</span>
<a id="__codelineno-3-133" name="__codelineno-3-133"></a><span class="w">            </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span><span class="c1">// replace i with j</span>
<a id="__codelineno-3-134" name="__codelineno-3-134"></a><span class="w">            </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">F</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">[</span><span class="n">Is</span><span class="p">(</span><span class="n">j</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="c1">// delete j</span>
<a id="__codelineno-3-135" name="__codelineno-3-135"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-3-136" name="__codelineno-3-136"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">dc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BLACK</span><span class="p">)</span><span class="w"> </span><span class="n">FixUp_Delete</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-3-137" name="__codelineno-3-137"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-138" name="__codelineno-3-138"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">Rank</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="k">return</span><span class="w"> </span><span class="n">Rank</span><span class="p">(</span><span class="n">Rot</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);}</span>
<a id="__codelineno-3-139" name="__codelineno-3-139"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">Kth</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">){</span><span class="k">return</span><span class="w"> </span><span class="n">Kth</span><span class="p">(</span><span class="n">Rot</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">);}</span>
<a id="__codelineno-3-140" name="__codelineno-3-140"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">Pre</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="k">return</span><span class="w"> </span><span class="n">Pre</span><span class="p">(</span><span class="n">Rot</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);}</span>
<a id="__codelineno-3-141" name="__codelineno-3-141"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">Next</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="k">return</span><span class="w"> </span><span class="n">Next</span><span class="p">(</span><span class="n">Rot</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);}</span>
<a id="__codelineno-3-142" name="__codelineno-3-142"></a><span class="p">}</span><span class="n">Tree</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</details>
<hr />
<h3 id="reverse-index">Reverse Index</h3>
<p>就是一个邻接矩阵一样的感觉，附加了一些简单的优化，没啥好说的</p>
<p>一些专有名词：</p>
<p><img alt="1713322642286" src="../image/ADS/1713322642286.png" /></p>
<p><img alt="1713321824724" src="../image/ADS/1713321824724.png" /></p>
<p><img alt="1713323080899" src="../image/ADS/1713323080899.png" /></p>
<p><img alt="1713676274087" src="../image/ADS/1713676274087.png" /></p>
<ul>
<li>
<p>Notes</p>
<ul>
<li>
<p>word stemming 会提高召回率，但是会影响精度</p>
</li>
<li>
<p>Thresholding 注意是document还是query,两者操作方式不一样</p>
</li>
<li>
<p>In data retrieval, the response time is more important than the relevance of the answer set. </p>
</li>
</ul>
</li>
</ul>
<hr />
<h3 id="leftist-tree">Leftist Tree</h3>
<blockquote>
<p>一种自平衡二叉堆，常用于两堆的快速合并操作</p>
</blockquote>
<ul>
<li>
<p>特征：</p>
<ul>
<li>
<p>堆的特性：根节点为子树中的最大 / 最小值</p>
</li>
<li>
<p>左偏：<strong>Npl(Ls) &gt;= Npl(Rs)</strong></p>
<ul>
<li>
<p>其中Npl(x)为x到最近空节点的距离，<strong>Npl(x) = min{Npl(C)} + 1</strong></p>
</li>
<li>
<p>规定<strong>Npl(NULL) = -1</strong> </p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>维护：</strong></p>
<ul>
<li>
<p><strong>核心操作 merge</strong></p>
<ul>
<li>
<p>选两颗树中根节点小的那棵作为主树</p>
</li>
<li>
<p>递归合并其右子树与剩下的那棵树</p>
</li>
<li>
<p>递归操作完成后，对左偏性质进行维护，交换不符性质的左右子树并维护 Npl</p>
</li>
</ul>
</li>
<li>
<p>插入</p>
<ul>
<li>可以视为主树与一个单一节点的树合并</li>
</ul>
</li>
<li>
<p>删除（最值）</p>
<ul>
<li>直接删除根节点，并合并其两棵子树 </li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>复杂度分析</strong></p>
<ul>
<li>
<p>可以利用类似红黑树中的数学归纳法，证明</p>
<blockquote>
<p>右路径上有 <span class="arithmatex">\(r\)</span> 个节点的左偏树至少有 <span class="arithmatex">\(2^r - 1\)</span>个节点</p>
<p>即右路径长度为<span class="arithmatex">\(O(logN)\)</span></p>
</blockquote>
</li>
<li>
<p>而左偏树的合并操作显然复杂度为右路径长度之和，因此复杂度为<span class="arithmatex">\(O(logN)\)</span>  </p>
</li>
</ul>
</li>
</ul>
<details class="collapsible">
<summary>Code (passed Luogu P3377)</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Leftist Tree</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span>
<span class="normal"><a href="#__codelineno-4-31">31</a></span>
<span class="normal"><a href="#__codelineno-4-32">32</a></span>
<span class="normal"><a href="#__codelineno-4-33">33</a></span>
<span class="normal"><a href="#__codelineno-4-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">Npl</span><span class="p">;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Rs</span><span class="p">;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="n">Node</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">_Key</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_Npl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">_pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="o">:</span><span class="n">Key</span><span class="p">(</span><span class="n">_Key</span><span class="p">),</span><span class="w"> </span><span class="n">Npl</span><span class="p">(</span><span class="n">_Npl</span><span class="p">),</span><span class="w"> </span><span class="n">Ls</span><span class="p">(</span><span class="n">_s</span><span class="p">),</span><span class="w"> </span><span class="n">Rs</span><span class="p">(</span><span class="n">_s</span><span class="p">),</span><span class="w"> </span><span class="n">pos</span><span class="p">(</span><span class="n">_pos</span><span class="p">){}</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Y</span><span class="p">)</span><span class="k">const</span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="n">Key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Y</span><span class="p">.</span><span class="n">Key</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Y</span><span class="p">.</span><span class="n">pos</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Key</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Y</span><span class="p">.</span><span class="n">Key</span><span class="p">;}</span><span class="w"> </span><span class="c1">// for this specific test problem</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="p">};</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">Leftist</span><span class="p">{</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w">    </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Rot</span><span class="p">;</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">NIL</span><span class="p">;</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="nf">Merge</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">R</span><span class="p">){</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NIL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">R</span><span class="p">;</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NIL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">L</span><span class="p">;</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">R</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">L</span><span class="p">)</span><span class="w"> </span><span class="n">swap</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">);</span><span class="w"> </span><span class="c1">// choose the root</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="w">            </span><span class="n">L</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Merge</span><span class="p">(</span><span class="n">L</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">);</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">L</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="o">-&gt;</span><span class="n">Npl</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">L</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="o">-&gt;</span><span class="n">Npl</span><span class="p">)</span><span class="w"> </span><span class="n">swap</span><span class="p">(</span><span class="n">L</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">);</span><span class="w"> </span><span class="c1">// maintain the property</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="w">            </span><span class="n">L</span><span class="o">-&gt;</span><span class="n">Npl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="o">-&gt;</span><span class="n">Npl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">        </span><span class="c1">// update Npl</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">L</span><span class="p">;</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a><span class="w">    </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="w">        </span><span class="n">Leftist</span><span class="p">()</span><span class="o">:</span><span class="n">Rot</span><span class="p">(</span><span class="n">NIL</span><span class="p">){}</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">Clear</span><span class="p">(){</span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NIL</span><span class="p">;}</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">Push</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Merge</span><span class="p">(</span><span class="n">Rot</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">NIL</span><span class="p">));}</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">Empty</span><span class="p">(){</span><span class="k">return</span><span class="w"> </span><span class="n">Rot</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NIL</span><span class="p">;}</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">Top</span><span class="p">(){</span><span class="k">return</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">;}</span>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">Top_pos</span><span class="p">(){</span><span class="k">return</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">;}</span><span class="w"> </span><span class="c1">// for this specific problem</span>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">Pop</span><span class="p">(){</span>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">Key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">;</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a><span class="w">            </span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Merge</span><span class="p">(</span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">);</span>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Key</span><span class="p">;</span>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">Merge</span><span class="p">(</span><span class="n">Leftist</span><span class="w"> </span><span class="n">T</span><span class="p">){</span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Merge</span><span class="p">(</span><span class="n">Rot</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">Rot</span><span class="p">);}</span>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a><span class="p">};</span>
<a id="__codelineno-4-34" name="__codelineno-4-34"></a><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Leftist</span><span class="o">::</span><span class="n">NIL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span><span class="w">  </span><span class="c1">// NULL Node</span>
</code></pre></div></td></tr></table></div>
</details>
<hr />
<h3 id="skew-heap">Skew Heap</h3>
<blockquote>
<p>也是一种自平衡二叉堆，常用于两堆的快速合并操作</p>
</blockquote>
<ul>
<li>
<p>特征：</p>
<ul>
<li>
<p>堆的特性：根节点为子树中的最大 / 最小值</p>
</li>
<li>
<p>Skew：<strong>不再维护Npl，而是通过每次强制交换左右子树的方式来维护平衡</strong></p>
<p>可以理解为 为了平衡，每次左边塞一个，右边塞一个</p>
</li>
<li>
<p><em>还有“中庸”版，randomize heap, 同样不用维护Npl, 不过为每次随机交换左右子树，期望平衡，其余写法一模一样</em></p>
</li>
</ul>
</li>
<li>
<p><strong>维护：</strong></p>
<ul>
<li>
<p><strong>核心操作 merge</strong></p>
<ul>
<li>
<p>选两棵树中根节点小的作为主树，交换其左右节点</p>
</li>
<li>
<p>递归合并其左节点与剩下的一棵树</p>
</li>
<li>
<p>当某棵树已经为空时可以直接接上，停止递归（会导致这棵剩下的子树内部没有充分旋转，影响见下方复杂度分析）    </p>
</li>
</ul>
</li>
<li>
<p>其余操作同左偏树都类似 </p>
</li>
</ul>
</li>
<li>
<p><strong>复杂度分析：</strong> </p>
</li>
</ul>
<p><em>采用天才的势能分析法</em></p>
<blockquote>
<p>定义势能函数 <span class="arithmatex">\(\Phi(i) = N_{heavy\ nodes}\)</span></p>
<p>其中 heavy node 重节点 定义为右子树比左子树大的节点</p>
</blockquote>
<p><strong>注意到每次合并都发生在左边，而左边都是右边换过去的，因此实际上是在右路径上操作，左边的那些结构不变，只要关注操作前整棵树的右路径</strong></p>
<p>将右路径单独剥离出来，设 <span class="arithmatex">\(H_i = l_i + h_i\)</span> (<span class="arithmatex">\(H_i\)</span> 为右路径节点数，<span class="arithmatex">\(l_i\)</span> 为其中light node, <span class="arithmatex">\(h_i\)</span> 为其中heavy node)</p>
<p>则对于一次merge, $$ c_i \leq H_1 + H_2 = l_1 + h_1 + l_2 + h_2 $$</p>
<p><strong>而每次 merge 之后， 右路径上所有的重节点将会变成轻节点， 轻节点有可能会变成重节点</strong></p>
<p>则 $$ \Delta \Phi(i) \leq (l_1 + l_2) - (h_1 + h_2) $$ (右路径外的重节点不变，会被抵消)</p>
<p>综上，得到 $$ \hat{c_i} \leq c_i + \Delta \Phi(i) = 2(l_1 + l_2) $$</p>
<p>根据轻节点定义，左子树一定大于右子树，而且在右路径上，从而 <span class="arithmatex">\(l_1 + l_2 = O(logN)\)</span></p>
<p>即证明了每次 merge 的摊还代价为 <span class="arithmatex">\(O(logN)\)</span></p>
<p>下面说明一下为什么提前终止不会影响摊还代价：</p>
<p>首先，提前终止确实会导致剩下的那棵子树中的重节点未被转化为轻节点</p>
<p>但是观察上方 <span class="arithmatex">\(\Delta \Phi(i)\)</span> 的式子会发现，这部分 <span class="arithmatex">\(\Delta h\)</span> 在前后的势能函数中保持不变，会被直接抵消，因此原式仍然成立</p>
<details class="collapsible">
<summary>Code（passed Luogu P3377）</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SkewHeap</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span>
<span class="normal"><a href="#__codelineno-5-28">28</a></span>
<span class="normal"><a href="#__codelineno-5-29">29</a></span>
<span class="normal"><a href="#__codelineno-5-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Rs</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="n">Node</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">_Key</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_pos</span><span class="p">)</span><span class="o">:</span><span class="n">Key</span><span class="p">(</span><span class="n">_Key</span><span class="p">),</span><span class="w"> </span><span class="n">pos</span><span class="p">(</span><span class="n">_pos</span><span class="p">),</span><span class="w"> </span><span class="n">Ls</span><span class="p">(</span><span class="nb">NULL</span><span class="p">),</span><span class="w"> </span><span class="n">Rs</span><span class="p">(</span><span class="nb">NULL</span><span class="p">){}</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Y</span><span class="p">)</span><span class="k">const</span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="n">Key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Y</span><span class="p">.</span><span class="n">Key</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Y</span><span class="p">.</span><span class="n">pos</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Key</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Y</span><span class="p">.</span><span class="n">Key</span><span class="p">;}</span><span class="w"> </span><span class="c1">// for this specific test problem</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="p">};</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">SkewHeap</span><span class="p">{</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">    </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Rot</span><span class="p">;</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="nf">Merge</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">R</span><span class="p">){</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">R</span><span class="p">;</span><span class="w">         </span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">L</span><span class="p">;</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">R</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">L</span><span class="p">)</span><span class="w"> </span><span class="n">swap</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">);</span><span class="w"> </span><span class="c1">// choose the smaller one as the root</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="w">            </span><span class="n">swap</span><span class="p">(</span><span class="n">L</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">);</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">            </span><span class="n">L</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Merge</span><span class="p">(</span><span class="n">L</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">);</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">L</span><span class="p">;</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w">    </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">Clear</span><span class="p">(){</span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;}</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">Push</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Merge</span><span class="p">(</span><span class="n">Rot</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">));}</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">Empty</span><span class="p">(){</span><span class="k">return</span><span class="w"> </span><span class="n">Rot</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;}</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">Top</span><span class="p">(){</span><span class="k">return</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">;}</span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">Top_pos</span><span class="p">(){</span><span class="k">return</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">;}</span>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">Pop</span><span class="p">(){</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">Key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">Key</span><span class="p">;</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="w">            </span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Merge</span><span class="p">(</span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="n">Rot</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">);</span>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Key</span><span class="p">;</span>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">Merge</span><span class="p">(</span><span class="n">SkewHeap</span><span class="w"> </span><span class="n">T</span><span class="p">){</span><span class="n">Rot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Merge</span><span class="p">(</span><span class="n">Rot</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">Rot</span><span class="p">);}</span>
<a id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
</details>
<hr />
<h3 id="binomial-queue">Binomial Queue</h3>
<ul>
<li>
<p><strong>特征</strong></p>
<ul>
<li>
<p>由一系列二项树组成，每个二项树都是一颗节点数为<span class="arithmatex">\(2^K\)</span>的树，满足第<span class="arithmatex">\(R\)</span>层的节点数为<span class="arithmatex">\(C_{K}^{R}\)</span></p>
</li>
<li>
<p>本质上每棵树就代表二进制位的一个“1”， 因此一切操作都可以看成在二进制上的运算</p>
</li>
</ul>
</li>
<li>
<p><strong>维护</strong></p>
<ul>
<li>
<p>插入</p>
<ul>
<li>相当于二进制+1, 新节点直接为一颗子树，然后向上进位合并</li>
</ul>
</li>
<li>
<p>删除</p>
<ul>
<li>
<p>找最小值显然需要遍历所有树根</p>
</li>
<li>
<p>删除根节点相当于二进制-1, 删除某颗树根节点后，将其子树分解为一个新的二项队列，然后两二进制数相加合并</p>
</li>
</ul>
</li>
<li>
<p>合并</p>
<ul>
<li>
<p>两个二项队列合并，相当于二进制相加，然后将进位的部分合并</p>
</li>
<li>
<p>两棵二项树合并，为了应用常用的“Left-Child-Next-Sibling”存储法，一般将子树按大小倒排，然后新来一颗同等大小的子树时，直接将根大的插到根小的左儿子上即可</p>
<p><em>（但是这种方式实际有点智障，不如加上最左最右儿子指针，详见下方代码部分）</em> </p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>复杂度分析：</p>
<ul>
<li>
<p><strong>插入</strong></p>
<ul>
<li>
<p>考虑单次进位，最坏复杂度为<span class="arithmatex">\(O(logN)\)</span></p>
</li>
<li>
<p>但是考虑每一位所能贡献的进位次数</p>
<div class="arithmatex">\[ T(N) = \frac{N}{2} + \frac{N}{2^2} + \frac{N}{2^3} + \cdots = O(N) \]</div>
<p>因此，插入操作的均摊复杂度为<span class="arithmatex">\(O(1)\)</span>    </p>
</li>
</ul>
</li>
<li>
<p><strong>合并</strong> </p>
<ul>
<li>
<p>由上可知，两棵二项树的合并是<span class="arithmatex">\(O(1)\)</span>的</p>
</li>
<li>
<p>二项队列的合并操作实际上就是二进制的加法，因此复杂度为<span class="arithmatex">\(O(logN) * O(1) = O(logN)\)</span></p>
</li>
</ul>
</li>
<li>
<p>删除</p>
<ul>
<li>
<p>查询最小值显然为<span class="arithmatex">\(O(logN)\)</span></p>
</li>
<li>
<p>删除本质上就是二项队列的合并，因此复杂为<span class="arithmatex">\(O(logN)\)</span>  </p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<details>
<summary>Code (Passed Luogu P3378)</summary>
<p>纯属自己NT，想要实现全链表版的，然后就被各种NULL指针和坏指针折磨（包括但不限于<strong>空指针判断、结构体重载小于号后忘记加“*”导致指针内存地址比大小等</strong>）</p>
<p>而且我越写越觉得课件中为了满足left-child-next-sibling的存储方式而倒排儿子实在是太智障了，因为二进制加法应该是从低位开始运算，这样会导致删除操作过于尴尬，甚至需要额外开销反转链表等</p>
<p>因此经历各种错误后，我选择正排儿子，保证merge的统一性，并且分别使用左右指针来记录最左边的儿子和最右边的儿子，保证了二项树合并仍然为O(1)，~~用较小的空间大大降低了编码复杂度~~</p>
<p>此外，由于用链表实现，两棵二项树包括进位的二项树的大小关系并不能保证，因此在双指针的基础上又要加入各种繁琐的判断，确实是有点麻烦的，还是数组实现比较好！！！</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Binomial Queue</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span>
<span class="normal"><a href="#__codelineno-6-33">33</a></span>
<span class="normal"><a href="#__codelineno-6-34">34</a></span>
<span class="normal"><a href="#__codelineno-6-35">35</a></span>
<span class="normal"><a href="#__codelineno-6-36">36</a></span>
<span class="normal"><a href="#__codelineno-6-37">37</a></span>
<span class="normal"><a href="#__codelineno-6-38">38</a></span>
<span class="normal"><a href="#__codelineno-6-39">39</a></span>
<span class="normal"><a href="#__codelineno-6-40">40</a></span>
<span class="normal"><a href="#__codelineno-6-41">41</a></span>
<span class="normal"><a href="#__codelineno-6-42">42</a></span>
<span class="normal"><a href="#__codelineno-6-43">43</a></span>
<span class="normal"><a href="#__codelineno-6-44">44</a></span>
<span class="normal"><a href="#__codelineno-6-45">45</a></span>
<span class="normal"><a href="#__codelineno-6-46">46</a></span>
<span class="normal"><a href="#__codelineno-6-47">47</a></span>
<span class="normal"><a href="#__codelineno-6-48">48</a></span>
<span class="normal"><a href="#__codelineno-6-49">49</a></span>
<span class="normal"><a href="#__codelineno-6-50">50</a></span>
<span class="normal"><a href="#__codelineno-6-51">51</a></span>
<span class="normal"><a href="#__codelineno-6-52">52</a></span>
<span class="normal"><a href="#__codelineno-6-53">53</a></span>
<span class="normal"><a href="#__codelineno-6-54">54</a></span>
<span class="normal"><a href="#__codelineno-6-55">55</a></span>
<span class="normal"><a href="#__codelineno-6-56">56</a></span>
<span class="normal"><a href="#__codelineno-6-57">57</a></span>
<span class="normal"><a href="#__codelineno-6-58">58</a></span>
<span class="normal"><a href="#__codelineno-6-59">59</a></span>
<span class="normal"><a href="#__codelineno-6-60">60</a></span>
<span class="normal"><a href="#__codelineno-6-61">61</a></span>
<span class="normal"><a href="#__codelineno-6-62">62</a></span>
<span class="normal"><a href="#__codelineno-6-63">63</a></span>
<span class="normal"><a href="#__codelineno-6-64">64</a></span>
<span class="normal"><a href="#__codelineno-6-65">65</a></span>
<span class="normal"><a href="#__codelineno-6-66">66</a></span>
<span class="normal"><a href="#__codelineno-6-67">67</a></span>
<span class="normal"><a href="#__codelineno-6-68">68</a></span>
<span class="normal"><a href="#__codelineno-6-69">69</a></span>
<span class="normal"><a href="#__codelineno-6-70">70</a></span>
<span class="normal"><a href="#__codelineno-6-71">71</a></span>
<span class="normal"><a href="#__codelineno-6-72">72</a></span>
<span class="normal"><a href="#__codelineno-6-73">73</a></span>
<span class="normal"><a href="#__codelineno-6-74">74</a></span>
<span class="normal"><a href="#__codelineno-6-75">75</a></span>
<span class="normal"><a href="#__codelineno-6-76">76</a></span>
<span class="normal"><a href="#__codelineno-6-77">77</a></span>
<span class="normal"><a href="#__codelineno-6-78">78</a></span>
<span class="normal"><a href="#__codelineno-6-79">79</a></span>
<span class="normal"><a href="#__codelineno-6-80">80</a></span>
<span class="normal"><a href="#__codelineno-6-81">81</a></span>
<span class="normal"><a href="#__codelineno-6-82">82</a></span>
<span class="normal"><a href="#__codelineno-6-83">83</a></span>
<span class="normal"><a href="#__codelineno-6-84">84</a></span>
<span class="normal"><a href="#__codelineno-6-85">85</a></span>
<span class="normal"><a href="#__codelineno-6-86">86</a></span>
<span class="normal"><a href="#__codelineno-6-87">87</a></span>
<span class="normal"><a href="#__codelineno-6-88">88</a></span>
<span class="normal"><a href="#__codelineno-6-89">89</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">BinomialQueue</span><span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="p">{</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">nxt</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Rs</span><span class="p">;</span><span class="w">    </span><span class="c1">// left-child-next-sibling + right-child to simplify the coding</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">        </span><span class="n">Node</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">_data</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">data</span><span class="p">(</span><span class="n">_data</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">Ls</span><span class="p">(</span><span class="nb">NULL</span><span class="p">),</span><span class="w"> </span><span class="n">nxt</span><span class="p">(</span><span class="nb">NULL</span><span class="p">),</span><span class="w"> </span><span class="n">Rs</span><span class="p">(</span><span class="nb">NULL</span><span class="p">){}</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">data</span><span class="p">;}</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Rots</span><span class="p">;</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="nf">Merge</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">j</span><span class="p">){</span><span class="c1">// Merge two binomial trees in O(1)</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">);</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="o">-&gt;</span><span class="n">nxt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">        </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">nxt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">nxt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Merge</span><span class="p">(</span><span class="n">BinomialQueue</span><span class="w"> </span><span class="o">*</span><span class="n">BQ</span><span class="p">){</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">BQ</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rots</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BQ</span><span class="o">-&gt;</span><span class="n">Rots</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">tp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="w">        </span><span class="c1">// i is the current node of this, j is the current node of BQ, k is the carry node</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="w">        </span><span class="c1">// t is the new line of the result, tp is the current node of the new line</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="w">        </span><span class="n">Rots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">){</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">))</span><span class="w"> </span><span class="n">swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">);</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="w">            </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">nxti</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">nxtj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">nxti</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">nxt</span><span class="p">;</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">nxtj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">nxt</span><span class="p">;</span><span class="w"> </span><span class="c1">// store the next node of i and j, otherwise it will be changed</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">){</span><span class="w"> </span><span class="c1">// easy task </span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">k</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="n">tp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w">          </span><span class="c1">// easy</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="n">tp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Merge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nxti</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nxtj</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1 + 1 + ?</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">tp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Merge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nxti</span><span class="p">;</span><span class="w">    </span><span class="c1">// 1 + 1 + 0</span>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="n">tp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nxti</span><span class="p">;</span><span class="w">                                      </span><span class="c1">// 1</span>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="w">            </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<a id="__codelineno-6-36" name="__codelineno-6-36"></a><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">cnt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w">   </span><span class="c1">// 1 node in the line  1 + 0 + 0</span>
<a id="__codelineno-6-37" name="__codelineno-6-37"></a><span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">tp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nxti</span><span class="p">;</span>
<a id="__codelineno-6-38" name="__codelineno-6-38"></a><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">tp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nxtj</span><span class="p">;</span>
<a id="__codelineno-6-39" name="__codelineno-6-39"></a><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="n">tp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-6-40" name="__codelineno-6-40"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-6-41" name="__codelineno-6-41"></a><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="n">tp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Merge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nxti</span><span class="p">;</span><span class="w">  </span><span class="c1">// 1 + 0 + 1</span>
<a id="__codelineno-6-42" name="__codelineno-6-42"></a><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="n">tp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w">   </span><span class="c1">// 0 + 0 + 1 </span>
<a id="__codelineno-6-43" name="__codelineno-6-43"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-6-44" name="__codelineno-6-44"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">tp</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<a id="__codelineno-6-45" name="__codelineno-6-45"></a><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">Rots</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">Rots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tp</span><span class="p">;</span><span class="k">else</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">nxt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tp</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">nxt</span><span class="p">;</span>
<a id="__codelineno-6-46" name="__codelineno-6-46"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">){</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">nxt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="k">break</span><span class="p">;}</span><span class="w"> </span><span class="c1">// break the loop to minimize the time complexity</span>
<a id="__codelineno-6-47" name="__codelineno-6-47"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-48" name="__codelineno-6-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-49" name="__codelineno-6-49"></a>
<a id="__codelineno-6-50" name="__codelineno-6-50"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-6-51" name="__codelineno-6-51"></a><span class="w">    </span><span class="n">BinomialQueue</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">Rots</span><span class="p">(</span><span class="nb">NULL</span><span class="p">){}</span>
<a id="__codelineno-6-52" name="__codelineno-6-52"></a><span class="w">    </span><span class="n">BinomialQueue</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Rots</span><span class="p">(</span><span class="n">x</span><span class="p">){}</span>
<a id="__codelineno-6-53" name="__codelineno-6-53"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">Empty</span><span class="p">(){</span><span class="k">return</span><span class="w"> </span><span class="n">Rots</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;}</span>
<a id="__codelineno-6-54" name="__codelineno-6-54"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Top</span><span class="p">(){</span><span class="w">  </span><span class="c1">// return the minimum element</span>
<a id="__codelineno-6-55" name="__codelineno-6-55"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Empty</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-6-56" name="__codelineno-6-56"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rots</span><span class="p">;</span>
<a id="__codelineno-6-57" name="__codelineno-6-57"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-6-58" name="__codelineno-6-58"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">nxt</span><span class="p">;</span>
<a id="__codelineno-6-59" name="__codelineno-6-59"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<a id="__codelineno-6-60" name="__codelineno-6-60"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-61" name="__codelineno-6-61"></a>
<a id="__codelineno-6-62" name="__codelineno-6-62"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Insert</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="n">Merge</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BinomialQueue</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="n">x</span><span class="p">)));}</span>
<a id="__codelineno-6-63" name="__codelineno-6-63"></a>
<a id="__codelineno-6-64" name="__codelineno-6-64"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Pop</span><span class="p">(){</span><span class="w"> </span><span class="c1">// pop the min</span>
<a id="__codelineno-6-65" name="__codelineno-6-65"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Empty</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-6-66" name="__codelineno-6-66"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rots</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Pre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Pos_Pre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-6-67" name="__codelineno-6-67"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">){</span>
<a id="__codelineno-6-68" name="__codelineno-6-68"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">Pos</span><span class="p">)</span><span class="w"> </span><span class="n">Pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">Pos_Pre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pre</span><span class="p">;</span>
<a id="__codelineno-6-69" name="__codelineno-6-69"></a><span class="w">            </span><span class="n">Pre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">nxt</span><span class="p">;</span>
<a id="__codelineno-6-70" name="__codelineno-6-70"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-71" name="__codelineno-6-71"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Pos_Pre</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">Rots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pos</span><span class="o">-&gt;</span><span class="n">nxt</span><span class="p">;</span><span class="k">else</span><span class="w"> </span><span class="n">Pos_Pre</span><span class="o">-&gt;</span><span class="n">nxt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pos</span><span class="o">-&gt;</span><span class="n">nxt</span><span class="p">;</span>
<a id="__codelineno-6-72" name="__codelineno-6-72"></a>
<a id="__codelineno-6-73" name="__codelineno-6-73"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pos</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-6-74" name="__codelineno-6-74"></a><span class="w">        </span><span class="n">Merge</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BinomialQueue</span><span class="p">(</span><span class="n">Pos</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">));</span>
<a id="__codelineno-6-75" name="__codelineno-6-75"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<a id="__codelineno-6-76" name="__codelineno-6-76"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-77" name="__codelineno-6-77"></a>
<a id="__codelineno-6-78" name="__codelineno-6-78"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Print</span><span class="p">(){</span><span class="w">  </span><span class="c1">// for debug</span>
<a id="__codelineno-6-79" name="__codelineno-6-79"></a><span class="w">        </span><span class="n">queue</span><span class="o">&lt;</span><span class="n">Node</span><span class="w"> </span><span class="o">*&gt;</span><span class="n">Q</span><span class="p">;</span>
<a id="__codelineno-6-80" name="__codelineno-6-80"></a><span class="w">        </span><span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Rots</span><span class="p">);</span>
<a id="__codelineno-6-81" name="__codelineno-6-81"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">Q</span><span class="p">.</span><span class="n">empty</span><span class="p">()){</span>
<a id="__codelineno-6-82" name="__codelineno-6-82"></a><span class="w">            </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="p">.</span><span class="n">front</span><span class="p">();</span><span class="w"> </span><span class="n">Q</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-6-83" name="__codelineno-6-83"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-6-84" name="__codelineno-6-84"></a><span class="w">            </span><span class="k">for</span><span class="p">(;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">nxt</span><span class="p">)</span><span class="w"> </span><span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">j</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">),</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-6-85" name="__codelineno-6-85"></a><span class="w">            </span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
<a id="__codelineno-6-86" name="__codelineno-6-86"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-87" name="__codelineno-6-87"></a><span class="w">        </span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
<a id="__codelineno-6-88" name="__codelineno-6-88"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-89" name="__codelineno-6-89"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
</details>
<hr />
<h3 id="fibonacci-heap">Fibonacci Heap</h3>
<ul>
<li>
<p><strong>特征</strong></p>
<ul>
<li>
<p>有点类似与二项队列，由一堆子树串接而成，但是每个节点可以有任意多的儿子，而且不再是二项树</p>
</li>
<li>
<p>兄弟间通过循环双向链表串接，父子间同样使用类似“Left-Child-Next-Sibling”存储方式 </p>
</li>
<li>
<p>具有最小堆的性质，即根节点为最小值 </p>
</li>
</ul>
</li>
<li>
<p><strong>维护</strong></p>
<ul>
<li>
<p>插入</p>
<ul>
<li>直接在root list中插入一个新的节点，然后更新最小值</li>
</ul>
</li>
<li>
<p>删除</p>
<ul>
<li>
<p>删除最小值，将其子树全部插入到root list中</p>
</li>
<li>
<p><strong>神奇合并</strong></p>
<ul>
<li>
<p>将root list中所有度相同（这里度 指节点的直连儿子数目）的子树按小根堆的方式合并</p>
</li>
<li>
<p>重复处理，直至root list中没有度相同的子树   </p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>合并</p>
<ul>
<li>两个堆合并，相当于两个root list做循环双向链表的合并，然后更新最小值即可</li>
</ul>
</li>
<li>
<p><strong>减小关键字</strong></p>
<ul>
<li>
<p>将节点的关键字减小，然后与父节点比较，如果小于父节点，则不满足小根堆的性质，将这棵子树摘下放到root list中，然后向上级联处理</p>
</li>
<li>
<p><strong>若某个非根节点已经失去了两个儿子，则将其摘下放到root list中，递归向上级联处理</strong> </p>
</li>
</ul>
</li>
<li>
<p>删除节点</p>
<ul>
<li>将节点的关键字减小到负无穷，然后删除最小值即可</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>复杂度分析</strong></p>
<blockquote>
<p>采用势能分析法，定义势能函数 <span class="arithmatex">\(\Phi(H) = t(H) + 2m(H)\)</span>，其中 <span class="arithmatex">\(t(H)\)</span> 为root list中的节点数，<span class="arithmatex">\(m(H)\)</span> 为已经标记过的节点数（即已经失去一个儿子的非根节点）</p>
<p>先要证明一点：N 个节点的斐波那契堆的子树的最大度数 <span class="arithmatex">\(D_n = O(logN)\)</span></p>
<p>为此，设节点 x 所在子树的节点数为 <span class="arithmatex">\(S_x\)</span>，则 <span class="arithmatex">\(S_x \geq F_{k+2}\)</span>, 其中 <span class="arithmatex">\(F_k\)</span> 为第 k 个斐波那契数</p>
<p>证明：</p>
<p>首先，对于 x 的所有按添加顺序排列的子树<span class="arithmatex">\(y_i\)</span>，有<span class="arithmatex">\(y_i \geq (i-1) -1 =i-2\)</span>（因为只有度数相同才能合并，并且每个节点最多失去一个儿子）</p>
<p>设度数为 k 的节点所在子树的最小大小为<span class="arithmatex">\(S_k\)</span>，则有 <span class="arithmatex">\(S_k \geq 2 + \Sigma_2^k size(y_i) \geq 2 + \Sigma_{2}^{k}S_{i-2} \geq F_{k+2}\)</span></p>
</blockquote>
<ul>
<li>
<p>插入</p>
<ul>
<li>直接插入到root list，显然复杂度为<span class="arithmatex">\(O(1)\)</span></li>
</ul>
</li>
<li>
<p><strong>删除</strong></p>
<ul>
<li>
<p>查询最小值可以直接用一个指针记录，因此为<span class="arithmatex">\(O(1)\)</span></p>
</li>
<li>
<p>删除时，首先需要将所有子树插入到root list中，需要<span class="arithmatex">\(O(D_N) = O(logN)\)</span></p>
</li>
<li>
<p><strong>神奇合并</strong>的均摊分析</p>
<ul>
<li>
<p>合并需要处理的总结点数最大为 <span class="arithmatex">\(D_N + t(H) - 1\)</span>，由于每次合并都会减少一个节点，因此实际开销的复杂度为<span class="arithmatex">\(O(D_N + t(H) - 1)\)</span></p>
</li>
<li>
<p>处理过后，显然<span class="arithmatex">\(t(H) \leq D_N + 1\)</span> </p>
</li>
<li>
<p>因此总均摊复杂度 
    $$\hat c_i = O(D_N + t(H)) + \Delta \Phi $$</p>
<div class="arithmatex">\[= O(D_N + t(H)) + ((D_N + 1 + 2m(H)) - (t(H) + 2m(H))) \]</div>
<div class="arithmatex">\[= O(D_N) = O(logN)\]</div>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>合并</p>
<ul>
<li>两个链表合并，显然复杂度为<span class="arithmatex">\(O(1)\)</span></li>
</ul>
</li>
<li>
<p><strong>减小关键字</strong></p>
<ul>
<li>
<p>主要在于递归向上级联断开的处理，下面证明其均摊复杂度为<span class="arithmatex">\(O(1)\)</span></p>
<blockquote>
<p>假设调用了 k 次递归向上的操作，即拔掉了 k - 1 个节点，复杂度为 <span class="arithmatex">\(O(k)\)</span></p>
<p><span class="arithmatex">\(\Delta \Phi \leq (t(H) + (k - 1) + 1 + 2(m(H) - (k - 1) + 1)) - (t(H) + 2m(H)) = 4 - c\)</span> </p>
<p>其中前面根节点的 +1 表示减小关键字的这棵子树，后面的 +1 表示最后停止时可能的新增标记</p>
<p>因此，最终的均摊复杂度 </p>
<div class="arithmatex">\[\hat c_i = O(k) + \Delta \Phi = O(1)\]</div>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<details class="collapsible">
<summary>Code (Passed Luogu P3371 &amp; P4779)</summary>
<p>斐波那契的优越性主要体现在插入和减小关键字的操作上，因为它可以在<span class="arithmatex">\(O(1)\)</span>的时间内完成</p>
<p>因此，在删除较少的情况下，斐波那契堆的效率是非常高的，但是在删除较多的情况下，由于总体常数较大，可能会比一般的堆更慢</p>
<p><strong>经典：斐波那契堆优化DIJ 复杂度 <span class="arithmatex">\(O(N + MlogM) --&gt; O(NlogN + M)\)</span>，在稠密图的优化效果还是非常明显的</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Fibonacci Heap</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">  1</a></span>
<span class="normal"><a href="#__codelineno-7-2">  2</a></span>
<span class="normal"><a href="#__codelineno-7-3">  3</a></span>
<span class="normal"><a href="#__codelineno-7-4">  4</a></span>
<span class="normal"><a href="#__codelineno-7-5">  5</a></span>
<span class="normal"><a href="#__codelineno-7-6">  6</a></span>
<span class="normal"><a href="#__codelineno-7-7">  7</a></span>
<span class="normal"><a href="#__codelineno-7-8">  8</a></span>
<span class="normal"><a href="#__codelineno-7-9">  9</a></span>
<span class="normal"><a href="#__codelineno-7-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-7-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-7-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-7-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-7-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-7-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-7-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-7-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-7-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-7-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-7-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-7-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-7-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-7-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-7-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-7-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-7-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-7-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-7-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-7-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-7-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-7-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-7-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-7-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-7-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-7-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-7-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-7-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-7-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-7-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-7-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-7-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-7-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-7-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-7-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-7-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-7-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-7-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-7-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-7-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-7-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-7-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-7-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-7-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-7-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-7-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-7-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-7-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-7-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-7-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-7-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-7-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-7-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-7-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-7-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-7-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-7-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-7-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-7-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-7-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-7-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-7-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-7-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-7-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-7-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-7-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-7-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-7-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-7-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-7-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-7-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-7-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-7-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-7-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-7-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-7-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-7-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-7-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-7-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-7-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-7-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-7-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-7-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-7-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-7-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-7-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-7-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-7-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-7-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-7-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-7-100">100</a></span>
<span class="normal"><a href="#__codelineno-7-101">101</a></span>
<span class="normal"><a href="#__codelineno-7-102">102</a></span>
<span class="normal"><a href="#__codelineno-7-103">103</a></span>
<span class="normal"><a href="#__codelineno-7-104">104</a></span>
<span class="normal"><a href="#__codelineno-7-105">105</a></span>
<span class="normal"><a href="#__codelineno-7-106">106</a></span>
<span class="normal"><a href="#__codelineno-7-107">107</a></span>
<span class="normal"><a href="#__codelineno-7-108">108</a></span>
<span class="normal"><a href="#__codelineno-7-109">109</a></span>
<span class="normal"><a href="#__codelineno-7-110">110</a></span>
<span class="normal"><a href="#__codelineno-7-111">111</a></span>
<span class="normal"><a href="#__codelineno-7-112">112</a></span>
<span class="normal"><a href="#__codelineno-7-113">113</a></span>
<span class="normal"><a href="#__codelineno-7-114">114</a></span>
<span class="normal"><a href="#__codelineno-7-115">115</a></span>
<span class="normal"><a href="#__codelineno-7-116">116</a></span>
<span class="normal"><a href="#__codelineno-7-117">117</a></span>
<span class="normal"><a href="#__codelineno-7-118">118</a></span>
<span class="normal"><a href="#__codelineno-7-119">119</a></span>
<span class="normal"><a href="#__codelineno-7-120">120</a></span>
<span class="normal"><a href="#__codelineno-7-121">121</a></span>
<span class="normal"><a href="#__codelineno-7-122">122</a></span>
<span class="normal"><a href="#__codelineno-7-123">123</a></span>
<span class="normal"><a href="#__codelineno-7-124">124</a></span>
<span class="normal"><a href="#__codelineno-7-125">125</a></span>
<span class="normal"><a href="#__codelineno-7-126">126</a></span>
<span class="normal"><a href="#__codelineno-7-127">127</a></span>
<span class="normal"><a href="#__codelineno-7-128">128</a></span>
<span class="normal"><a href="#__codelineno-7-129">129</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">FiboHeap</span><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="p">{</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="c1">// pos denotes the node, data denotes the distance</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">degree</span><span class="p">;</span><span class="w">     </span><span class="c1">// degree records the direct children of this node</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Rs</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Fa</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Son</span><span class="p">;</span><span class="c1">//Ls &amp; Rs for cycle list with siblings, Fa for parent, Son for  a single child (randomly chosen)</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">mark</span><span class="p">;</span><span class="w">      </span><span class="c1">// spcecial signal for FiboHeap, set to 1 if a child of this node has been removed</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">        </span><span class="n">Node</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">_pos</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_data</span><span class="p">){</span><span class="w">    </span><span class="c1">// new Node at node _pos with value _data</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">            </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_pos</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_data</span><span class="p">;</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">            </span><span class="n">degree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">            </span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">Fa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Son</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">            </span><span class="n">mark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">Remove</span><span class="p">(){</span><span class="w">  </span><span class="c1">// remove this Node from the cycle-list</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="w">            </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">;</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="w">            </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">;</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="w">            </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Fa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">Link</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">R</span><span class="p">){</span><span class="w"> </span><span class="c1">// link this node between L and R</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="w">            </span><span class="n">L</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L</span><span class="p">;</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="w">            </span><span class="n">R</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">;</span>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Size</span><span class="p">;</span>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Min</span><span class="p">;</span>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">Dis</span><span class="p">[</span><span class="n">MaxN</span><span class="p">];</span>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Consolidate</span><span class="p">(){</span><span class="w"> </span><span class="c1">// Consolidating the nodes (subtrees) in root list</span>
<a id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="n">MaxS</span><span class="p">];</span><span class="c1">// A[i] denotes the subtree with degree i</span>
<a id="__codelineno-7-29" name="__codelineno-7-29"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="p">;</span>
<a id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="w">        </span><span class="n">LL</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// State of the degree of the root list, more precisely locate the nodes not null</span>
<a id="__codelineno-7-31" name="__codelineno-7-31"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">){</span>
<a id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="w">            </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">;</span>
<a id="__codelineno-7-33" name="__codelineno-7-33"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-7-34" name="__codelineno-7-34"></a><span class="w">            </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">Remove</span><span class="p">();</span>
<a id="__codelineno-7-35" name="__codelineno-7-35"></a><span class="w">            </span><span class="k">while</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">degree</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">){</span><span class="w">    </span><span class="c1">// merge the subtree with the same degree, ensure the degree of the root list is unique</span>
<a id="__codelineno-7-36" name="__codelineno-7-36"></a><span class="w">                </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">degree</span><span class="p">];</span>
<a id="__codelineno-7-37" name="__codelineno-7-37"></a><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="n">swap</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">);</span><span class="w"> </span><span class="c1">// minimum heap</span>
<a id="__codelineno-7-38" name="__codelineno-7-38"></a>
<a id="__codelineno-7-39" name="__codelineno-7-39"></a><span class="w">                </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Fa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="mf">1l</span><span class="n">l</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">degree</span><span class="p">),</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">degree</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-7-40" name="__codelineno-7-40"></a><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">Son</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">Son</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="k">else</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">Link</span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">Son</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">Son</span><span class="p">);</span>
<a id="__codelineno-7-41" name="__codelineno-7-41"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-7-42" name="__codelineno-7-42"></a><span class="w">            </span><span class="n">S</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="mf">1l</span><span class="n">l</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">degree</span><span class="p">),</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">degree</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<a id="__codelineno-7-43" name="__codelineno-7-43"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-44" name="__codelineno-7-44"></a><span class="w">        </span><span class="n">Min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-7-45" name="__codelineno-7-45"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="n">S</span><span class="p">){</span>
<a id="__codelineno-7-46" name="__codelineno-7-46"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__builtin_ctzll</span><span class="p">(</span><span class="n">S</span><span class="p">);</span><span class="c1">// find the first bit 1</span>
<a id="__codelineno-7-47" name="__codelineno-7-47"></a><span class="w">            </span><span class="n">S</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="mf">1l</span><span class="n">l</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-7-48" name="__codelineno-7-48"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">Min</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">Min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Min</span><span class="p">;</span>
<a id="__codelineno-7-49" name="__codelineno-7-49"></a><span class="w">            </span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-7-50" name="__codelineno-7-50"></a><span class="w">                </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Link</span><span class="p">(</span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">);</span>
<a id="__codelineno-7-51" name="__codelineno-7-51"></a><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="n">Min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-7-52" name="__codelineno-7-52"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-7-53" name="__codelineno-7-53"></a><span class="w">            </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-7-54" name="__codelineno-7-54"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-55" name="__codelineno-7-55"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-56" name="__codelineno-7-56"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Cut</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="p">){</span><span class="w"> </span><span class="c1">// cut p from its parent q</span>
<a id="__codelineno-7-57" name="__codelineno-7-57"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">Son</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-7-58" name="__codelineno-7-58"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">)</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">Son</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="k">else</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">Son</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">;</span>
<a id="__codelineno-7-59" name="__codelineno-7-59"></a><span class="w">        </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Remove</span><span class="p">(),</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">degree</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-7-60" name="__codelineno-7-60"></a>
<a id="__codelineno-7-61" name="__codelineno-7-61"></a><span class="w">        </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">mark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Link</span><span class="p">(</span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">);</span>
<a id="__codelineno-7-62" name="__codelineno-7-62"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-63" name="__codelineno-7-63"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">CascadingCut</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">){</span><span class="w"> </span><span class="c1">// cascading cut p recursively</span>
<a id="__codelineno-7-64" name="__codelineno-7-64"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Fa</span><span class="p">;</span>
<a id="__codelineno-7-65" name="__codelineno-7-65"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">){</span>
<a id="__codelineno-7-66" name="__codelineno-7-66"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">mark</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">mark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-7-67" name="__codelineno-7-67"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="n">Cut</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">),</span><span class="w"> </span><span class="n">CascadingCut</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<a id="__codelineno-7-68" name="__codelineno-7-68"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-69" name="__codelineno-7-69"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-70" name="__codelineno-7-70"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-7-71" name="__codelineno-7-71"></a><span class="w">    </span><span class="n">FiboHeap</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">Min</span><span class="p">(</span><span class="nb">NULL</span><span class="p">),</span><span class="w"> </span><span class="n">Size</span><span class="p">(</span><span class="mi">0</span><span class="p">){}</span>
<a id="__codelineno-7-72" name="__codelineno-7-72"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Clear</span><span class="p">(){</span><span class="n">Min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;}</span>
<a id="__codelineno-7-73" name="__codelineno-7-73"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">Empty</span><span class="p">(){</span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">Size</span><span class="p">;}</span><span class="w"> </span><span class="c1">// check if the heap is empty</span>
<a id="__codelineno-7-74" name="__codelineno-7-74"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Insert</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-7-75" name="__codelineno-7-75"></a><span class="w">        </span><span class="n">Size</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-7-76" name="__codelineno-7-76"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w">  </span><span class="c1">// build a new Node &amp; insert it into root list</span>
<a id="__codelineno-7-77" name="__codelineno-7-77"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Min</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">){</span>
<a id="__codelineno-7-78" name="__codelineno-7-78"></a><span class="w">            </span><span class="n">Min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a id="__codelineno-7-79" name="__codelineno-7-79"></a><span class="w">            </span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Min</span><span class="p">;</span>
<a id="__codelineno-7-80" name="__codelineno-7-80"></a><span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-7-81" name="__codelineno-7-81"></a><span class="w">            </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Link</span><span class="p">(</span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">);</span>
<a id="__codelineno-7-82" name="__codelineno-7-82"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="n">Min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a id="__codelineno-7-83" name="__codelineno-7-83"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-84" name="__codelineno-7-84"></a><span class="w">        </span><span class="n">Dis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a id="__codelineno-7-85" name="__codelineno-7-85"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-86" name="__codelineno-7-86"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Top</span><span class="p">(){</span><span class="k">return</span><span class="w"> </span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;}</span><span class="w"> </span><span class="c1">// get the minimum value</span>
<a id="__codelineno-7-87" name="__codelineno-7-87"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">Find</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="k">return</span><span class="w"> </span><span class="n">Dis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;}</span><span class="w">    </span><span class="c1">// check if the i-th node is in the heap</span>
<a id="__codelineno-7-88" name="__codelineno-7-88"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">GetData</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="k">return</span><span class="w"> </span><span class="n">Dis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;}</span><span class="w"> </span><span class="c1">// get the value of i-th node</span>
<a id="__codelineno-7-89" name="__codelineno-7-89"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Merge</span><span class="p">(</span><span class="n">FiboHeap</span><span class="w"> </span><span class="o">*</span><span class="n">H</span><span class="p">){</span><span class="w">    </span><span class="c1">// merge two heaps(not used in this problem)</span>
<a id="__codelineno-7-90" name="__codelineno-7-90"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">H</span><span class="o">-&gt;</span><span class="n">Min</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-7-91" name="__codelineno-7-91"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Min</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)(</span><span class="n">Min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="o">-&gt;</span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="o">-&gt;</span><span class="n">Size</span><span class="p">);</span>
<a id="__codelineno-7-92" name="__codelineno-7-92"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="o">-&gt;</span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">;</span>
<a id="__codelineno-7-93" name="__codelineno-7-93"></a><span class="w">        </span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Min</span><span class="p">;</span>
<a id="__codelineno-7-94" name="__codelineno-7-94"></a><span class="w">        </span><span class="n">L</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="o">-&gt;</span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="o">-&gt;</span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L</span><span class="p">;</span>
<a id="__codelineno-7-95" name="__codelineno-7-95"></a><span class="w">        </span><span class="n">Size</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">H</span><span class="o">-&gt;</span><span class="n">Size</span><span class="p">;</span>
<a id="__codelineno-7-96" name="__codelineno-7-96"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">H</span><span class="o">-&gt;</span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="n">Min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="o">-&gt;</span><span class="n">Min</span><span class="p">;</span>
<a id="__codelineno-7-97" name="__codelineno-7-97"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-98" name="__codelineno-7-98"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Pop</span><span class="p">(){</span><span class="w">  </span><span class="c1">// pop the minimum value</span>
<a id="__codelineno-7-99" name="__codelineno-7-99"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">Son</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="p">;</span>
<a id="__codelineno-7-100" name="__codelineno-7-100"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">){</span><span class="w">   </span><span class="c1">// split the subtree of the minimum node, and insert them into the root list</span>
<a id="__codelineno-7-101" name="__codelineno-7-101"></a><span class="w">            </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">;</span>
<a id="__codelineno-7-102" name="__codelineno-7-102"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-7-103" name="__codelineno-7-103"></a><span class="w">            </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">Remove</span><span class="p">(),</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">Link</span><span class="p">(</span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">Ls</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">);</span>
<a id="__codelineno-7-104" name="__codelineno-7-104"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-105" name="__codelineno-7-105"></a><span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Min</span><span class="p">;</span>
<a id="__codelineno-7-106" name="__codelineno-7-106"></a>
<a id="__codelineno-7-107" name="__codelineno-7-107"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">)</span><span class="w"> </span><span class="n">Min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-7-108" name="__codelineno-7-108"></a><span class="w">        </span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-7-109" name="__codelineno-7-109"></a><span class="w">            </span><span class="n">Min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Rs</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Remove</span><span class="p">();</span>
<a id="__codelineno-7-110" name="__codelineno-7-110"></a><span class="w">            </span><span class="n">Consolidate</span><span class="p">();</span>
<a id="__codelineno-7-111" name="__codelineno-7-111"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-112" name="__codelineno-7-112"></a><span class="w">        </span><span class="n">Size</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-7-113" name="__codelineno-7-113"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-7-114" name="__codelineno-7-114"></a><span class="w">    </span><span class="p">}</span><span class="w">       </span>
<a id="__codelineno-7-115" name="__codelineno-7-115"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Decrease</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="w">    </span><span class="c1">// decrease the value of i-th Node to x</span>
<a id="__codelineno-7-116" name="__codelineno-7-116"></a><span class="w">        </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Dis</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-7-117" name="__codelineno-7-117"></a><span class="w">        </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-7-118" name="__codelineno-7-118"></a>
<a id="__codelineno-7-119" name="__codelineno-7-119"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Fa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">){</span><span class="w">      </span><span class="c1">// if the node is not in the root list</span>
<a id="__codelineno-7-120" name="__codelineno-7-120"></a><span class="w">            </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Fa</span><span class="p">;</span>
<a id="__codelineno-7-121" name="__codelineno-7-121"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">){</span><span class="w">  </span><span class="c1">// if the value of the node is smaller than its parent, cut it &amp; cascading cut its parent</span>
<a id="__codelineno-7-122" name="__codelineno-7-122"></a><span class="w">                </span><span class="n">Cut</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">);</span>
<a id="__codelineno-7-123" name="__codelineno-7-123"></a><span class="w">                </span><span class="n">CascadingCut</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<a id="__codelineno-7-124" name="__codelineno-7-124"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-7-125" name="__codelineno-7-125"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-126" name="__codelineno-7-126"></a>
<a id="__codelineno-7-127" name="__codelineno-7-127"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Min</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="n">Min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w">  </span><span class="c1">// update the minimum value</span>
<a id="__codelineno-7-128" name="__codelineno-7-128"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-129" name="__codelineno-7-129"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
</details>
<hr />
<h2 id="algorithm">Algorithm</h2>
<hr />
<h3 id="amortized-analysis">Amortized Analysis (摊还分析)</h3>
<blockquote>
<p>worst-case bound &gt;= amortized bound &gt;= average-case bound(强弱关系)</p>
</blockquote>
<ul>
<li>
<p><strong>Aggregated Analysis (聚类分析)</strong></p>
<ul>
<li>
<p>对于一个长度为N的操作序列，若该操作序列的最坏时间复杂度为T(N),则该操作序列的平均时间复杂度（摊还代价）为 T(N) / N</p>
</li>
<li>
<p>简单粗暴，但是很多时候不够精确，因为 T(N) 并不一定好求 </p>
</li>
</ul>
</li>
<li>
<p><strong>Accounting Method (核算法)</strong></p>
<ul>
<li>
<p>为每个操作分配一个额外摊还代价，从而便于估计总代价</p>
</li>
<li>
<p>常见理解： 将额外分配的代价视为存钱，之后的一些操作可以通过取钱来解决，从而使得总代价不会超过预期</p>
</li>
<li>
<p><em>个人感觉</em>，不如直接从定义式上去理解</p>
<ul>
<li>
<p><span class="arithmatex">\(\sum_{i=1}^{n}c_i + \sum_{i=1}^{n}t_i \leq \sum_{i=1}^{n}a_i\)</span></p>
</li>
<li>
<p><span class="arithmatex">\(c_i\)</span> 为实际每一步的代价，<span class="arithmatex">\(t_i\)</span> 为额外摊还代价，<span class="arithmatex">\(a_i\)</span> 为估计的摊还代价</p>
</li>
<li>
<p>因而只要让<span class="arithmatex">\(t_i \geq 0\)</span>, 就能保证分析的复杂度一定是上界。换句话说，类似于数列放缩，通过合理~~（玄学）~~的分配权值，使得总和不会超过预期</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Potential Method（势能法）</strong></p>
<ul>
<li>
<p>给每个状态分配一个势能，将摊还代价视为势能的变化</p>
<ul>
<li>
<p><span class="arithmatex">\(c_i\)</span> 为实际每一步的代价，<span class="arithmatex">\(a_i\)</span> 为估计的摊还代价，<span class="arithmatex">\(\Phi_i\)</span> 为势能</p>
</li>
<li>
<p><span class="arithmatex">\(\Phi_0 = 0\)</span></p>
</li>
<li>
<p><span class="arithmatex">\(c_i + \Phi_i - \Phi_{i-1} =a_i\)</span>  </p>
</li>
<li>
<p>两边求和，得到 <span class="arithmatex">\(\sum_{i=1}^{n}c_i + \Phi_{n} = \sum_{i=1}^{n}a_i\)</span></p>
</li>
</ul>
</li>
<li>
<p>从而相当于获得比核算法更加宽松的条件，我们不再需要每一步的摊还代价都为正，只要选择一个玄学的势能函数（考虑题目特性），保证最后一个状态的势能为正即可</p>
</li>
<li>
<p>Splay Tree</p>
<ul>
<li>
<p>选择势能函数 <span class="arithmatex">\(\Phi = \sum_{i=1}^{n}log(size_i)\)</span>, 即为每个节点的子树大小之和</p>
</li>
<li>
<p>对三种旋转操作进行分别分析，可以证明，每次旋转的摊还代价为 <span class="arithmatex">\(O(logN)\)</span></p>
</li>
<li>
<p><img alt="Proof" src="../images/splay.png" /></p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>NOTES:</p>
<ul>
<li>Amortized bounds are weaker than the corresponding worst-case bounds, because there is no guarantee for any single operation. </li>
</ul>
</li>
</ul>
<hr />
<h3 id="backtracking">BackTracking</h3>
<p><span class="arithmatex">\(\alpha - \beta\)</span> pruning</p>
<ul>
<li>
<p><span class="arithmatex">\(\alpha\)</span></p>
<ul>
<li>
<p>求最大值，当前节点求最小值且当前值已经偏小</p>
<p><img alt="1713338332411" src="../image/ADS/1713338332411.png" /></p>
</li>
</ul>
</li>
<li>
<p><span class="arithmatex">\(\beta\)</span></p>
<ul>
<li>
<p>求最小值，当前节点求最大值且当前值已经偏大</p>
<p><img alt="1713338362260" src="../image/ADS/1713338362260.png" /> </p>
</li>
</ul>
</li>
</ul>
<details class="danger">
<summary>❌</summary>
<p>Evaluating the time complexity in backtracking algorithms involves considering various factors. Some important elements that affect time complexity in backtracking include:</p>
<div class="highlight"><pre><span></span><code>![1718356767426](image/ADS/1718356767426.png)
</code></pre></div>
<ul>
<li>
<p>The number of decisions or choices to be made at each step.</p>
</li>
<li>
<p>The size of the problem space or the search space.</p>
</li>
<li>
<p>Constraints and pruning techniques applied to reduce the search space.</p>
</li>
<li>
<p><img alt="1718356738980" src="../image/ADS/1718356738980.png" /></p>
</li>
</ul>
</details>
<hr />
<h3 id="divide-and-conquer">Divide and Conquer（分治）</h3>
<blockquote>
<p>分治是非常重要的程序设计方法，但在课中更注重相关<strong>分治时间复杂度递推式</strong>的计算</p>
<p><span class="arithmatex">\(T(N) = a T(N/b) + f(N)\)</span></p>
</blockquote>
<ul>
<li>
<p><strong>带入法</strong></p>
<ul>
<li>
<p>得到一个好的猜测（可以用后面介绍的递归树辅助）</p>
</li>
<li>
<p>使用数学归纳法完成证明</p>
<p><strong>注意这里运算要求相关常数 c 保持严格一致性，即显式地证明 <span class="arithmatex">\(T(N) \leq cF(N)\)</span> 否则界是不对的</strong></p>
<p>例如对于最经典的 <span class="arithmatex">\(T(N) = 2 T(N/2) + N\)</span></p>
<div class="arithmatex">\[ T(N) \leq 2 c (N/2) log(N/2) + N = cNlog(N) +(1-c)N \leq cNlogN = O(N)\]</div>
<div class="arithmatex">\[ T(N) \leq 2c (N/2) + N = (c+1)N \neq O(N)\]</div>
</li>
<li>
<p><em>算法导论中提到，有时归纳假设不够强时，可以尝试减去一个低阶项来弥补</em></p>
</li>
</ul>
</li>
<li>
<p><strong>递归树</strong> </p>
</li>
</ul>
<blockquote>
<p>如上面提到的，是一个非常好的 <strong>获得猜测</strong> 甚至 <strong>直接计算答案</strong> 的方法</p>
</blockquote>
<ul>
<li>
<p>一般的，对于上面提到的“工整”的式子，他的递归树是一棵完全 a 叉树，总共有 <span class="arithmatex">\(\log_b^N\)</span> 层，第 i 层有 <span class="arithmatex">\(a^i\)</span> 个节点，每个节点的代价为 <span class="arithmatex">\(f(N/b^i)\)</span>，因此第 i 层总代价为 <span class="arithmatex">\(a^i f(N/b^i)\)</span></p>
<p><em>最后一层严格时视为 <span class="arithmatex">\(\Theta(a^{log_b^N}) = \Theta(N^{log_b^a})\)</span> ，实际直接当T(1)=O(1)直接计算也可</em></p>
<p>示例如下：</p>
<div class="arithmatex">\[ T(N) = 3 T(N/4) + cN^2 \]</div>
<p><img alt="RecursionT1" src="../images/RecursionT1.png" /></p>
</li>
<li>
<p>对于歪斜的式子，例如下面的式子，有时精确的代价会很难计算，~~感性理解猜测~~</p>
<div class="arithmatex">\[ T(N) = T(N/3) + T(2N/3) + cN \]</div>
<p>整棵树应该是右斜的，前面几层的代价巧恰好为 <span class="arithmatex">\(cN\)</span>，而后面几层显然会铺不满，因此可以得到一个上界 <span class="arithmatex">\(O(N\log_{\frac{3}{2}}^N)\)</span> （如果恰好铺满），进而猜测 <span class="arithmatex">\(T(N) = O(N \log{N})\)</span> ，可以用代入法验证  </p>
<p><img alt="RecursionT2" src="../images/RecursionT2.png" /></p>
</li>
<li>
<p><strong>主方法</strong></p>
</li>
</ul>
<blockquote>
<p><span class="arithmatex">\(f(N) = O(N^{\log_b^a - \epsilon}), T(N) = \Theta(N^{\log_b^a})\)</span></p>
<p><span class="arithmatex">\(f(N) = \Theta(N^{\log_b^a}), T(N) = \Theta(N^{\log_b^a} \log N)\)</span></p>
<p><span class="arithmatex">\(f(N) = \Omega(N^{\log_b^a + \epsilon}), T(N) = \Theta(f(N)) (\exists c &lt; 1, af(n/b) \leq cf(n))\)</span></p>
</blockquote>
<ul>
<li>
<p><strong>简单记忆，就是看递归式的前一项大还是后一项大，或者说，递归树上的叶子节点代价大还是根节点代价大，若相等则都统计乘上logN</strong></p>
<p>其中这里指的大小是多项式意义上的大小，相差为 <span class="arithmatex">\(N^{\epsilon}\)</span> 倍，比如 <span class="arithmatex">\(N\)</span> 与 <span class="arithmatex">\(N \log N\)</span> 就不能在这个意义下比大小，也就无法使用一般的主方法</p>
<p>关于case 3的正则化条件，本质上就是保证根节点最大</p>
</li>
<li>
<p><strong>证明（结合递归树）</strong></p>
<p><img alt="Recursion" src="../images/RecursionT.png" /></p>
<ul>
<li>根据三种情况的条件，对几何级数进行求和，比较容易得到结论 </li>
</ul>
</li>
<li>
<p><em>前面提到的一种特殊情况，实际上下两种符合原本主定理的条件，只要考虑中间那种幂指数一样(<span class="arithmatex">\(N^{\log_b^a} = N^k\)</span>)但后面挂了个log尾巴的情况</em></p>
<p>用递归树求和后会发现</p>
<div class="arithmatex">\[ T(N) = N^{\log_b^a} \Sigma_{i=0}^{\log_b^a} \lg^p \frac{N}{b^i} = N^{\log_b^a} \Sigma_{i=0}^{\log_b^a} (\lg{N} - \lg{b^i})^p \]</div>
<div class="arithmatex">\[\approx N^{\log_b^a} \Sigma_{i=0}^{\log_b^a} \lg^p{N}=N^{\log_b^a} \log_b^a \lg^p{N} \]</div>
<div class="arithmatex">\[= \Theta(N^{\log_b^a} \lg^{p+1}{N})\]</div>
<p><img alt="log" src="../images/Master_log.png" /></p>
</li>
</ul>
<details class="danger">
<summary>❌</summary>
<ul>
<li>
<p><img alt="1718357583418" src="../image/ADS/1718357583418.png" /></p>
<p>closest points pair problem，需要将坐标按照 x 轴排序</p>
<p>跨越中线的如下处理，其中在递归过程中完成对y轴的排序</p>
<p><img alt="1718424432204" src="../image/ADS/1718424432204.png" /></p>
</li>
</ul>
</details>
<hr />
<h3 id="fft-fntt">FFT &amp; FNTT</h3>
<blockquote>
<p><strong>Fast Fourier Transform &amp; Fast Number Theoretic Transform</strong></p>
<p>Here we only discuss the application of FFT in polynomial multiplication</p>
</blockquote>
<p>For coefficient representated polynomials <span class="arithmatex">\(A(x) = \sum_{i=0}^{n-1} a_i x^i, B(x) = \sum_{i=1}^{n-1} b_i x^i\)</span>, the polynomial multication can seen as the convolutions which needs <span class="arithmatex">\(O(n^2)\)</span> </p>
<p>We can also represent a n-degree polynomial as a vector of n points <span class="arithmatex">\(\{(x_1, A(x_1)), (x_2, A(x_2)), ... (x_{n-1},A(x_{n-1}))\}\)</span></p>
<blockquote>
<p>proof: <strong>Lagrange Interpolation using Vandermonde Matrix</strong></p>
<div class="arithmatex">\[ \begin{bmatrix} 1 &amp; x_0 &amp; x_0^2 &amp; \cdots &amp; x_0^{n-1} \\ 
1 &amp; x_1 &amp; x_1^2 &amp; \cdots &amp; x_1^{n-1} \\ 
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ 
1 &amp; x_{n-1} &amp; x_{n-1}^2 &amp; \cdots &amp; x_{n-1}^{n-1} \end{bmatrix} 
\begin{bmatrix} a_0 \\ a_1 \\ \vdots \\ a_{n-1} \end{bmatrix} = 
\begin{bmatrix} A(x_0) \\ A(x_1) \\ \vdots \\ A(x_{n-1}) \end{bmatrix} \]</div>
<p>If all <span class="arithmatex">\(x_i\)</span> are unique, then the determinant of the vandermonde matrix is <span class="arithmatex">\(\prod_{0 \leq i &lt; j &lt; n} (x_j - x_i) \neq 0\)</span>, which means there exists a unique solution for the coefficient vector, or say, the polynomial can be uniquely represented by the n points</p>
</blockquote>
<p>Then the polynomial multiplication can be seen as the vector dot product, which can be done in <span class="arithmatex">\(O(n)\)</span></p>
<p>If we use point-value representaion <span class="arithmatex">\(\{(x_i,A(x_i))\}, \{x_i, B(x_i)\}\)</span>, then the polynomial multiplication can be seen as a vector dot product, which can be done in <span class="arithmatex">\(O(n)\)</span></p>
<p>So the key point is the fast transformation between the coefficient representation and point-value representation, Which can be done in <span class="arithmatex">\(O(nlogn)\)</span> using FFT</p>
<p><img alt="1713882091475" src="../image/ADS/1713882091475.png" /></p>
<ul>
<li>
<p><strong>coeffcient to point-value</strong></p>
<ul>
<li>
<p>If we randomly choose n points, then the transformation should be done in <span class="arithmatex">\(O(n) * O(n) = O(n^2)\)</span>,  which is not so good</p>
</li>
<li>
<p>Here we choose a novel method, selecting the complex n powers of n-th root of unity <span class="arithmatex">\(w_n = e^{2\pi i / n}\)</span>, that is, <span class="arithmatex">\(w_n^0, w_n, w_n^2, ... w_n^{n-1}\)</span></p>
<ul>
<li>
<p>Special property:</p>
<ul>
<li>
<p>Definition: <span class="arithmatex">\(w_n^n = 1\)</span></p>
</li>
<li>
<p>Halving Lemma: <span class="arithmatex">\(w_{2n}^{2k} = w_n^k\)</span> </p>
<p><em>Proved easily by Euler's Formula, <span class="arithmatex">\(w_{2n}^{2k} = e^{2\pi i \frac{2k}{2n}} = e^{2\pi i \frac{k}{n}} = w_n^k\)</span></em> </p>
</li>
<li>
<p>Inverse Lemma: <span class="arithmatex">\(w_n^{k + \frac{n}{2}} = -w_n^{k}\)</span></p>
<p><em>Proved easily by Euler's Formula, <span class="arithmatex">\(w_n^{k + \frac{n}{2}} = e^{2\pi i \frac{k + \frac{n}{2}}{n}} = e^{2\pi i \frac{k}{n} + \pi i} = -e^{2\pi i \frac{k}{n}} = -w_n^k\)</span></em></p>
</li>
<li>
<p>Summation Lemma: <span class="arithmatex">\(\sum_{i=0}^{n-1} w_n^{ik} = \begin{cases} n &amp; \text{if } n | k \\ 0 &amp; \text{otherwise} \end{cases}\)</span></p>
<p><em>Proved easily by the geometric progression, <span class="arithmatex">\(S = 1 + w_n^k + w_n^{2k} + ... + w_n^{(n-1)k} = \frac{1 - w_n^{nk}}{1 - w_n^k} = 0\)</span></em></p>
</li>
<li>
<p><em>Halving &amp; Inverse Lemmas are quite useful in the FFT algorithm, which can be seen as a divide-and-conquer algorithm</em></p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Considre a polynomial <span class="arithmatex">\(A(x) = a_0 + a_1 x + a_2 x^2 + ... + a_{n-1} x^{n-1}\)</span>,where <span class="arithmatex">\(n = 2^k\)</span> (Easier to cope with, so we can append 0s as coefficients to make it a power of 2)</p>
<p>Then we divide the polynomial into two parts:</p>
<div class="arithmatex">\[ A_1(x) = a_0 + a_2 x + a_4 x^2 + ... + a_{n-2} x^{n/2 - 1} \]</div>
<div class="arithmatex">\[ A_2(x) = a_1 + a_3 x + a_5 x^2 + ... + a_{n-1} x^{n/2 - 1} \]</div>
<p>Then we can see that </p>
<div class="arithmatex">\[A(x) = A_1(x^2) + xA_2(x^2)\]</div>
<p>Substitute <span class="arithmatex">\(w_n^k\)</span> and using Halving Lemma</p>
<div class="arithmatex">\[A(w_n^k) = A_1(w_{n}^{2k}) + w_n^k A_2(w_{n}^{2k}) = A_1(w_{\frac{n}{2}}^k) + w_n^k A_2(w_{\frac{n}{2}}^k)\]</div>
<p>Substituting the rest <span class="arithmatex">\(w_{n}^{k+\frac{n}{2}}\)</span> and using Inverse Lemma</p>
<div class="arithmatex">\[A(w_n^{k+\frac{n}{2}}) = A_1(w_{\frac{n}{2}}^k) - w_n^k A_2(w_{\frac{n}{2}}^k)\]</div>
<p>Now to get <span class="arithmatex">\(A(w_n^{k})\)</span> for <span class="arithmatex">\(k=0,1,...n-1\)</span>，we only need to calculate <span class="arithmatex">\(A_1(w_{\frac{n}{2}}^k)\)</span> and <span class="arithmatex">\(A_2(w_{\frac{n}{2}}^k)\)</span> for <span class="arithmatex">\(k=0,1,...\frac{n}{2}-1\)</span>, which is just half of the original problem!</p>
<div class="highlight"><span class="filename">FFT</span><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="w">    </span><span class="n">FFT</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,...</span><span class="n">n</span><span class="mi">-1</span><span class="p">]){</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">A</span><span class="p">;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">        </span><span class="n">A1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FFT</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,...</span><span class="n">n</span><span class="mi">-2</span><span class="p">])</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">        </span><span class="n">A2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FFT</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,...</span><span class="n">n</span><span class="mi">-1</span><span class="p">])</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">        </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">            </span><span class="n">A</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w</span><span class="o">^</span><span class="n">k</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">A2</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">            </span><span class="n">A</span><span class="p">[</span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">w</span><span class="o">^</span><span class="n">k</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">A2</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">A</span><span class="p">;</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>More efficient way</p>
<blockquote>
<p>Use <strong>Butterfly Operation</strong> instead of Recursion</p>
</blockquote>
<p><em>Maybe because of this photo so-called butterfly?</em></p>
<p><img alt="1713884617148" src="../image/ADS/1713884617148.png" /></p>
<p>Check the clearer picture below, we can find the final position is just the inverse of its original position's binary represention!</p>
<p>So based on this discovery, we can easily transform the recursive version into an iterative version, which is more efficient.</p>
<p><img alt="1713884430459" src="../image/ADS/1713884430459.png" /> </p>
</li>
</ul>
</li>
<li>
<p><strong>point-value to coefficient</strong></p>
<blockquote>
<p>Use the Lagrange Interpolation as mentioned above</p>
</blockquote>
<ul>
<li>
<p>The Vandermond Matrix <span class="arithmatex">\(V_n A = Y\)</span></p>
<div class="arithmatex">\[ \begin{bmatrix} 1 &amp; 1^1 &amp; 1^2 &amp; \cdots &amp; 1^{n-1} \\ 
1 &amp; w_n^1 &amp; w_n^2 &amp; \cdots &amp; w_n^{n-1} \\ 
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ 
1 &amp; w_n^{n-1} &amp; w_n^{2(n-1)} &amp; \cdots &amp; w_n^{(n-1)(n-1)} \end{bmatrix} 
\begin{bmatrix} a_0 \\ a_1 \\ \vdots \\ a_{n-1} \end{bmatrix} = 
\begin{bmatrix} y_0 \\ y_1 \\ \vdots \\ y_{n-1} \end{bmatrix} \]</div>
<p>Recall the knowledge in Linear Algebra, the next step is to calculate the <span class="arithmatex">\(V_n^{-1}\)</span>, then <span class="arithmatex">\(A = V_n^{-1}Y\)</span></p>
<p>Consider the definition of inverse matrix</p>
<div class="arithmatex">\[V_n^{-1} V_n = I_n\]</div>
<div class="arithmatex">\[I_{ij} = \sum_{k=0}^{n-1} V^{-1}_{ik} V_{kj} = \sum_{k=0}^{n-1} V^{-1}_{ik} w_n^{kj}\]</div>
<p>Thinking of the Summation Lemma, we can <em>easily find</em> the <span class="arithmatex">\(V_{ij}^{-1} = w_n^{-ij}\)</span>, which is the similar form of the <span class="arithmatex">\(V_n\)</span>, like a vector-direction inverse on the complex plane</p>
<p>So given the point-value representation, we can solve the corresponding coefficient representation by just changing the <span class="arithmatex">\(w_n^k\)</span> to <span class="arithmatex">\(w_n^{-k}\)</span> </p>
</li>
</ul>
</li>
</ul>
<p>In conclusion, the FFT algorithm is a very efficient algorithm for polynomial multiplication, which can be done in <span class="arithmatex">\(O(n \log n)\)</span></p>
<p>However, since the use of double type in the complex number calculation, the precision of the result may be affected. We can then put the problem into the modulo field, which is the Fast Number Theoretic Transform (FNTT).</p>
<p>Wonderfully, the FNTT is almost the same as the FFT, except that we change the complex n-th root of unity to the primitive root of the modulo field, which has the same properties as the n-th root of unity as mentioned above.</p>
<ul>
<li>
<p><em>primitive root g</em>:</p>
<div class="arithmatex">\[g_n^n \equiv 1 \pmod{P}\]</div>
<div class="arithmatex">\[g_n^{\frac{n}{2}} \equiv -1 \pmod{P}\]</div>
<div class="arithmatex">\[g_l = g^{\frac{P-1}{l}} \pmod{P}\]</div>
</li>
<li>
<p>Example: </p>
<blockquote>
<p>RB-Tree count: Count the number of different RB-Trees with N nodes.</p>
</blockquote>
<p>Using <strong>Generating Function</strong> <span class="arithmatex">\(T_h(x)\)</span> for the RB-Trees with black height h </p>
<div class="arithmatex">\[T_h(x) = \sum_{i=0}^{n} a_i x^i\]</div>
<p>where <span class="arithmatex">\(a_i\)</span> denotes the number of RB-Trees with black height h and i nodes</p>
<p>Consider the  subtree of a RB-Tree</p>
<div class="arithmatex">\[\begin{cases} T_{h-1}(x)\  (black \ subtree) \\
xT_{h-1}^2(x) \ (red \ subtree, must \ have \ two \ black \  sub-subtrees) \\ 
\end{cases}\]</div>
<p>Since a black root have two subtrees where order matters, we can easily get the recursive formula</p>
<div class="arithmatex">\[T_h(x) = x N_{h-1}^2= x(T_{h-1}(x) + xT_{h-1}^2(x))^2\]</div>
<p>The answer is the sum of all <span class="arithmatex">\(a_n\)</span></p>
<p><em>If the module prime is not good like 998244353 with primitive root, we need complicated MTT, which I haven't learned yet</em></p>
</li>
</ul>
<details class="collapsible">
<summary>Code</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">RB-Tree Count</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">  1</a></span>
<span class="normal"><a href="#__codelineno-9-2">  2</a></span>
<span class="normal"><a href="#__codelineno-9-3">  3</a></span>
<span class="normal"><a href="#__codelineno-9-4">  4</a></span>
<span class="normal"><a href="#__codelineno-9-5">  5</a></span>
<span class="normal"><a href="#__codelineno-9-6">  6</a></span>
<span class="normal"><a href="#__codelineno-9-7">  7</a></span>
<span class="normal"><a href="#__codelineno-9-8">  8</a></span>
<span class="normal"><a href="#__codelineno-9-9">  9</a></span>
<span class="normal"><a href="#__codelineno-9-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-9-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-9-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-9-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-9-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-9-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-9-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-9-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-9-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-9-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-9-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-9-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-9-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-9-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-9-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-9-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-9-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-9-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-9-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-9-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-9-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-9-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-9-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-9-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-9-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-9-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-9-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-9-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-9-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-9-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-9-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-9-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-9-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-9-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-9-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-9-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-9-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-9-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-9-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-9-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-9-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-9-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-9-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-9-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-9-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-9-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-9-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-9-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-9-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-9-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-9-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-9-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-9-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-9-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-9-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-9-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-9-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-9-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-9-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-9-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-9-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-9-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-9-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-9-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-9-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-9-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-9-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-9-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-9-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-9-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-9-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-9-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-9-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-9-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-9-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-9-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-9-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-9-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-9-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-9-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-9-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-9-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-9-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-9-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-9-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-9-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-9-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-9-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-9-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-9-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-9-100">100</a></span>
<span class="normal"><a href="#__codelineno-9-101">101</a></span>
<span class="normal"><a href="#__codelineno-9-102">102</a></span>
<span class="normal"><a href="#__codelineno-9-103">103</a></span>
<span class="normal"><a href="#__codelineno-9-104">104</a></span>
<span class="normal"><a href="#__codelineno-9-105">105</a></span>
<span class="normal"><a href="#__codelineno-9-106">106</a></span>
<span class="normal"><a href="#__codelineno-9-107">107</a></span>
<span class="normal"><a href="#__codelineno-9-108">108</a></span>
<span class="normal"><a href="#__codelineno-9-109">109</a></span>
<span class="normal"><a href="#__codelineno-9-110">110</a></span>
<span class="normal"><a href="#__codelineno-9-111">111</a></span>
<span class="normal"><a href="#__codelineno-9-112">112</a></span>
<span class="normal"><a href="#__codelineno-9-113">113</a></span>
<span class="normal"><a href="#__codelineno-9-114">114</a></span>
<span class="normal"><a href="#__codelineno-9-115">115</a></span>
<span class="normal"><a href="#__codelineno-9-116">116</a></span>
<span class="normal"><a href="#__codelineno-9-117">117</a></span>
<span class="normal"><a href="#__codelineno-9-118">118</a></span>
<span class="normal"><a href="#__codelineno-9-119">119</a></span>
<span class="normal"><a href="#__codelineno-9-120">120</a></span>
<span class="normal"><a href="#__codelineno-9-121">121</a></span>
<span class="normal"><a href="#__codelineno-9-122">122</a></span>
<span class="normal"><a href="#__codelineno-9-123">123</a></span>
<span class="normal"><a href="#__codelineno-9-124">124</a></span>
<span class="normal"><a href="#__codelineno-9-125">125</a></span>
<span class="normal"><a href="#__codelineno-9-126">126</a></span>
<span class="normal"><a href="#__codelineno-9-127">127</a></span>
<span class="normal"><a href="#__codelineno-9-128">128</a></span>
<span class="normal"><a href="#__codelineno-9-129">129</a></span>
<span class="normal"><a href="#__codelineno-9-130">130</a></span>
<span class="normal"><a href="#__codelineno-9-131">131</a></span>
<span class="normal"><a href="#__codelineno-9-132">132</a></span>
<span class="normal"><a href="#__codelineno-9-133">133</a></span>
<span class="normal"><a href="#__codelineno-9-134">134</a></span>
<span class="normal"><a href="#__codelineno-9-135">135</a></span>
<span class="normal"><a href="#__codelineno-9-136">136</a></span>
<span class="normal"><a href="#__codelineno-9-137">137</a></span>
<span class="normal"><a href="#__codelineno-9-138">138</a></span>
<span class="normal"><a href="#__codelineno-9-139">139</a></span>
<span class="normal"><a href="#__codelineno-9-140">140</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="cp">#include</span><span class="cpf">&lt;bits/stdc++.h&gt;</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="cp">#define LL long long</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="p">;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="c1">// Coefficient representation of polynomial</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">Poly</span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="k">private</span><span class="o">:</span><span class="w"> </span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">    </span><span class="c1">// Primitive root of P 998244353(7 * 17 * 2^23 + 1) is 3</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">    </span><span class="c1">// _G = 3 ^ (-1) (Mod P)</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_G</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">332748118</span><span class="p">;</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="w">    </span><span class="c1">// Coefficients a[i] * x^i</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a><span class="w">    </span><span class="c1">// quick pow x^y in O(log(y))</span>
<a id="__codelineno-9-16" name="__codelineno-9-16"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Pow</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">){</span>
<a id="__codelineno-9-17" name="__codelineno-9-17"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-9-18" name="__codelineno-9-18"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="n">y</span><span class="p">){</span>
<a id="__codelineno-9-19" name="__codelineno-9-19"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">LL</span><span class="p">)</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">P</span><span class="p">;</span>
<a id="__codelineno-9-20" name="__codelineno-9-20"></a><span class="w">            </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">LL</span><span class="p">)</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&gt;&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-9-22" name="__codelineno-9-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a id="__codelineno-9-23" name="__codelineno-9-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-24" name="__codelineno-9-24"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-9-25" name="__codelineno-9-25"></a><span class="w">    </span><span class="c1">// Module </span>
<a id="__codelineno-9-26" name="__codelineno-9-26"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">998244353</span><span class="p">;</span>
<a id="__codelineno-9-27" name="__codelineno-9-27"></a><span class="w">    </span><span class="n">Poly</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">L</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-9-28" name="__codelineno-9-28"></a><span class="w">    </span><span class="n">Poly</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_a</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">_a</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-9-29" name="__codelineno-9-29"></a>
<a id="__codelineno-9-30" name="__codelineno-9-30"></a><span class="w">    </span><span class="c1">// the length of the polynomial</span>
<a id="__codelineno-9-31" name="__codelineno-9-31"></a><span class="w">    </span><span class="kr">inline</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Length</span><span class="p">()</span><span class="k">const</span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">();}</span>
<a id="__codelineno-9-32" name="__codelineno-9-32"></a>
<a id="__codelineno-9-33" name="__codelineno-9-33"></a><span class="w">    </span><span class="c1">// robust access to the coeffcient a[i]</span>
<a id="__codelineno-9-34" name="__codelineno-9-34"></a><span class="w">    </span><span class="kr">inline</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Para</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="k">const</span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Length</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;}</span>
<a id="__codelineno-9-35" name="__codelineno-9-35"></a>
<a id="__codelineno-9-36" name="__codelineno-9-36"></a><span class="w">    </span><span class="c1">// add a constant (in this problem is just for +1)</span>
<a id="__codelineno-9-37" name="__codelineno-9-37"></a><span class="w">    </span><span class="n">Poly</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="o">+</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">B</span><span class="p">){</span>
<a id="__codelineno-9-38" name="__codelineno-9-38"></a><span class="w">        </span><span class="n">Poly</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-9-39" name="__codelineno-9-39"></a><span class="w">        </span><span class="n">C</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">B</span><span class="p">;</span>
<a id="__codelineno-9-40" name="__codelineno-9-40"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">C</span><span class="p">;</span>
<a id="__codelineno-9-41" name="__codelineno-9-41"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-42" name="__codelineno-9-42"></a>
<a id="__codelineno-9-43" name="__codelineno-9-43"></a><span class="w">    </span><span class="c1">// addition of two polynomial: just add the corresponding coefficient, O(length)</span>
<a id="__codelineno-9-44" name="__codelineno-9-44"></a><span class="w">    </span><span class="n">Poly</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="o">+</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Poly</span><span class="w"> </span><span class="o">&amp;</span><span class="n">B</span><span class="p">){</span>
<a id="__codelineno-9-45" name="__codelineno-9-45"></a><span class="w">        </span><span class="n">Poly</span><span class="w"> </span><span class="nf">C</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Length</span><span class="p">(),</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">Length</span><span class="p">()));</span>
<a id="__codelineno-9-46" name="__codelineno-9-46"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">C</span><span class="p">.</span><span class="n">Length</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">C</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Para</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">Para</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">P</span><span class="p">;</span>
<a id="__codelineno-9-47" name="__codelineno-9-47"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">C</span><span class="p">;</span>
<a id="__codelineno-9-48" name="__codelineno-9-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-49" name="__codelineno-9-49"></a>
<a id="__codelineno-9-50" name="__codelineno-9-50"></a><span class="w">    </span><span class="c1">// plus x^i, just like shift</span>
<a id="__codelineno-9-51" name="__codelineno-9-51"></a><span class="w">    </span><span class="n">Poly</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span>
<a id="__codelineno-9-52" name="__codelineno-9-52"></a><span class="w">        </span><span class="n">Poly</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-9-53" name="__codelineno-9-53"></a><span class="w">        </span><span class="n">C</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">Length</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w">   </span><span class="c1">// make more capacity</span>
<a id="__codelineno-9-54" name="__codelineno-9-54"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">.</span><span class="n">Length</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="n">C</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">];</span><span class="w">   </span><span class="c1">//move the data</span>
<a id="__codelineno-9-55" name="__codelineno-9-55"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="n">C</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// set the first ones to 0</span>
<a id="__codelineno-9-56" name="__codelineno-9-56"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">C</span><span class="p">;</span>
<a id="__codelineno-9-57" name="__codelineno-9-57"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-58" name="__codelineno-9-58"></a>
<a id="__codelineno-9-59" name="__codelineno-9-59"></a><span class="w">    </span><span class="c1">// FNTT: fast number-theoretic transform</span>
<a id="__codelineno-9-60" name="__codelineno-9-60"></a><span class="w">    </span><span class="c1">// f = 1: transform the coefficient representation to point-value representaion </span>
<a id="__codelineno-9-61" name="__codelineno-9-61"></a><span class="w">    </span><span class="c1">// f = -1: inv-transform as f = 1, to transform back to coefficient representation using interpolating polynomial</span>
<a id="__codelineno-9-62" name="__codelineno-9-62"></a><span class="w">    </span><span class="c1">// both done in O(nlogn)</span>
<a id="__codelineno-9-63" name="__codelineno-9-63"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">NTT</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pos</span><span class="p">){</span>
<a id="__codelineno-9-64" name="__codelineno-9-64"></a><span class="w">        </span><span class="c1">// butterfly operation, transform the recursive into loops</span>
<a id="__codelineno-9-65" name="__codelineno-9-65"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<a id="__codelineno-9-66" name="__codelineno-9-66"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="n">swap</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]]);</span>
<a id="__codelineno-9-67" name="__codelineno-9-67"></a>
<a id="__codelineno-9-68" name="__codelineno-9-68"></a><span class="w">        </span><span class="c1">// bottom-up calculation </span>
<a id="__codelineno-9-69" name="__codelineno-9-69"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">L</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">L</span><span class="w"> </span><span class="o">&lt;&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span>
<a id="__codelineno-9-70" name="__codelineno-9-70"></a><span class="w">            </span><span class="c1">// the primitive root chosen W_n / (W_n ^ -1)</span>
<a id="__codelineno-9-71" name="__codelineno-9-71"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">Wl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pow</span><span class="p">((</span><span class="o">~</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">_G</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">P</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-9-72" name="__codelineno-9-72"></a><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)){</span>
<a id="__codelineno-9-73" name="__codelineno-9-73"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">Wk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="c1">// twiddle factor</span>
<a id="__codelineno-9-74" name="__codelineno-9-74"></a><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">L</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">,</span><span class="w"> </span><span class="n">Wk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">LL</span><span class="p">)</span><span class="w"> </span><span class="n">Wk</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Wl</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">P</span><span class="p">){</span>
<a id="__codelineno-9-75" name="__codelineno-9-75"></a><span class="w">                    </span><span class="c1">// recursively done, A[j+k] &amp; A[j+k+L] are calculated at the same time</span>
<a id="__codelineno-9-76" name="__codelineno-9-76"></a><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="p">],</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">LL</span><span class="p">)</span><span class="w"> </span><span class="n">Wk</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">L</span><span class="p">]</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">P</span><span class="p">;</span>
<a id="__codelineno-9-77" name="__codelineno-9-77"></a><span class="w">                    </span><span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">L</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">P</span><span class="p">;</span>
<a id="__codelineno-9-78" name="__codelineno-9-78"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-9-79" name="__codelineno-9-79"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-9-80" name="__codelineno-9-80"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-9-81" name="__codelineno-9-81"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-82" name="__codelineno-9-82"></a>
<a id="__codelineno-9-83" name="__codelineno-9-83"></a><span class="w">    </span><span class="c1">// NTT</span>
<a id="__codelineno-9-84" name="__codelineno-9-84"></a><span class="w">    </span><span class="n">Poly</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Poly</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_B</span><span class="p">){</span>
<a id="__codelineno-9-85" name="__codelineno-9-85"></a><span class="w">        </span><span class="c1">// append 0s to ensure the length to be the power of 2</span>
<a id="__codelineno-9-86" name="__codelineno-9-86"></a><span class="w">        </span><span class="c1">// it makes recursion more easily without influence the answer</span>
<a id="__codelineno-9-87" name="__codelineno-9-87"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-9-88" name="__codelineno-9-88"></a><span class="w">        </span><span class="k">while</span><span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">L</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Length</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">_B</span><span class="p">.</span><span class="n">Length</span><span class="p">())</span><span class="w"> </span><span class="n">L</span><span class="o">++</span><span class="p">;</span><span class="w">  </span>
<a id="__codelineno-9-89" name="__codelineno-9-89"></a><span class="w">        </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_B</span><span class="p">.</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">L</span><span class="p">),</span><span class="w"> </span><span class="n">pos</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">L</span><span class="p">);</span>
<a id="__codelineno-9-90" name="__codelineno-9-90"></a><span class="w">        </span><span class="c1">// make transformation for the butterfly operation</span>
<a id="__codelineno-9-91" name="__codelineno-9-91"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">L</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">((</span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-9-92" name="__codelineno-9-92"></a><span class="w">        </span><span class="n">L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">L</span><span class="p">;</span>
<a id="__codelineno-9-93" name="__codelineno-9-93"></a><span class="w">        </span><span class="n">A</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">L</span><span class="p">),</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">L</span><span class="p">);</span>
<a id="__codelineno-9-94" name="__codelineno-9-94"></a>
<a id="__codelineno-9-95" name="__codelineno-9-95"></a><span class="w">        </span><span class="n">NTT</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">),</span><span class="w"> </span><span class="n">NTT</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span><span class="w">   </span><span class="c1">// change to point-value representation</span>
<a id="__codelineno-9-96" name="__codelineno-9-96"></a><span class="w">        </span><span class="c1">// multiplication can be done in O(n) now in point-value representation</span>
<a id="__codelineno-9-97" name="__codelineno-9-97"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">L</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">LL</span><span class="p">)</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">P</span><span class="p">;</span><span class="w">  </span>
<a id="__codelineno-9-98" name="__codelineno-9-98"></a><span class="w">        </span><span class="n">NTT</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span><span class="w">    </span><span class="c1">// to transform back</span>
<a id="__codelineno-9-99" name="__codelineno-9-99"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">Inv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pow</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w">   </span><span class="c1">// 1/n in module space</span>
<a id="__codelineno-9-100" name="__codelineno-9-100"></a><span class="w">        </span><span class="c1">// trick: remove the coefficient that over n, which can&#39;t contribute to the answer</span>
<a id="__codelineno-9-101" name="__codelineno-9-101"></a><span class="w">        </span><span class="n">C</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Length</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">_B</span><span class="p">.</span><span class="n">Length</span><span class="p">()));</span><span class="w"> </span>
<a id="__codelineno-9-102" name="__codelineno-9-102"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">C</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">LL</span><span class="p">)</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Inv</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">P</span><span class="p">;</span>
<a id="__codelineno-9-103" name="__codelineno-9-103"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Poly</span><span class="p">(</span><span class="n">C</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-9-104" name="__codelineno-9-104"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-105" name="__codelineno-9-105"></a>
<a id="__codelineno-9-106" name="__codelineno-9-106"></a><span class="w">    </span><span class="c1">// for debug</span>
<a id="__codelineno-9-107" name="__codelineno-9-107"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Print</span><span class="p">(){</span>
<a id="__codelineno-9-108" name="__codelineno-9-108"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="o">:</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span>
<a id="__codelineno-9-109" name="__codelineno-9-109"></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-9-110" name="__codelineno-9-110"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-111" name="__codelineno-9-111"></a><span class="p">};</span>
<a id="__codelineno-9-112" name="__codelineno-9-112"></a>
<a id="__codelineno-9-113" name="__codelineno-9-113"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
<a id="__codelineno-9-114" name="__codelineno-9-114"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span>
<a id="__codelineno-9-115" name="__codelineno-9-115"></a><span class="w">    </span><span class="c1">// T[i] denotes the generating function of RB-Tree that with bh(root) = i+1</span>
<a id="__codelineno-9-116" name="__codelineno-9-116"></a><span class="w">    </span><span class="c1">// ai is the number of RB-trees with i nodes</span>
<a id="__codelineno-9-117" name="__codelineno-9-117"></a><span class="w">    </span><span class="c1">// T[i] = Sum(ai * x^i)</span>
<a id="__codelineno-9-118" name="__codelineno-9-118"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Poly</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="p">;</span>
<a id="__codelineno-9-119" name="__codelineno-9-119"></a><span class="w">    </span><span class="c1">// T[0] --&gt; bh(root) = 1</span>
<a id="__codelineno-9-120" name="__codelineno-9-120"></a><span class="w">    </span><span class="c1">// a0 = 0 (impossible)</span>
<a id="__codelineno-9-121" name="__codelineno-9-121"></a><span class="w">    </span><span class="c1">// a1 = 1 (only root)</span>
<a id="__codelineno-9-122" name="__codelineno-9-122"></a><span class="w">    </span><span class="c1">// a2 = 2 (root with single red child)</span>
<a id="__codelineno-9-123" name="__codelineno-9-123"></a><span class="w">    </span><span class="c1">// a3 = 1 (root with two red children)</span>
<a id="__codelineno-9-124" name="__codelineno-9-124"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T0</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span>
<a id="__codelineno-9-125" name="__codelineno-9-125"></a><span class="w">    </span><span class="n">T</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="n">T0</span><span class="p">));</span>
<a id="__codelineno-9-126" name="__codelineno-9-126"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Para</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
<a id="__codelineno-9-127" name="__codelineno-9-127"></a>
<a id="__codelineno-9-128" name="__codelineno-9-128"></a><span class="w">    </span><span class="c1">// by the amortized analysis proof in class, we know N &gt;= 2^bh(root) - 1</span>
<a id="__codelineno-9-129" name="__codelineno-9-129"></a><span class="w">    </span><span class="c1">// thus bh(root) &lt;= log(N+1)</span>
<a id="__codelineno-9-130" name="__codelineno-9-130"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log2</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">h</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-9-131" name="__codelineno-9-131"></a><span class="w">        </span><span class="c1">// T[i] = x * T[i-1]^2 * (1 + x * T[i-1])^2</span>
<a id="__codelineno-9-132" name="__codelineno-9-132"></a><span class="w">        </span><span class="n">Poly</span><span class="w"> </span><span class="n">Ti</span><span class="w"> </span><span class="o">=</span><span class="p">((</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]);</span>
<a id="__codelineno-9-133" name="__codelineno-9-133"></a><span class="w">        </span><span class="n">Ti</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ti</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ti</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-9-134" name="__codelineno-9-134"></a><span class="w">        </span><span class="c1">// add answer for N nodes</span>
<a id="__codelineno-9-135" name="__codelineno-9-135"></a><span class="w">        </span><span class="n">Ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Ans</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Ti</span><span class="p">.</span><span class="n">Para</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">Poly</span><span class="o">::</span><span class="n">P</span><span class="p">;</span>
<a id="__codelineno-9-136" name="__codelineno-9-136"></a><span class="w">        </span><span class="n">T</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Ti</span><span class="p">);</span>
<a id="__codelineno-9-137" name="__codelineno-9-137"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-138" name="__codelineno-9-138"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Ans</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-9-139" name="__codelineno-9-139"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-9-140" name="__codelineno-9-140"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<hr />
<h3 id="greedy">*Greedy</h3>
<p>就讲了最经典的<strong>任务调度</strong>问题和<strong>Huffman编码</strong>问题，略过了。</p>
<details class="danger">
<summary>❌</summary>
<ul>
<li>
<p><img alt="1718195534324" src="../image/ADS/1718195534324.png" /></p>
<p>一个构造例子如下，实际上下面的近似算法里面已经讲了 <strong>Set Cover</strong>的界是<span class="arithmatex">\(O(\log n)\)</span>，为2的是另一个选边算法</p>
<p><img alt="1718195370827" src="../image/ADS/1718195370827.png" /></p>
</li>
</ul>
<hr />
<ul>
<li>
<p><img alt="1718195564421" src="../image/ADS/1718195564421.png" /></p>
<p>大意了，应该想到算法1会导致之后新开的房间的任务排得不够紧密，导致出问题的</p>
</li>
</ul>
<hr />
<ul>
<li><img alt="1718418929358" src="../image/ADS/1718418929358.png" /></li>
</ul>
<hr />
<ul>
<li><img alt="1718418964692" src="../image/ADS/1718418964692.png" /> </li>
</ul>
</details>
<hr />
<h3 id="np-completeness">NP-Completeness</h3>
<ul>
<li>
<p><strong>Relation</strong></p>
<ul>
<li>
<p>P=NP</p>
<p><img alt="1718197581566" src="../image/ADS/1718197581566.png" /></p>
</li>
<li>
<p>P != NP</p>
<p><img alt="1718197832233" src="../image/ADS/1718197832233.png" /></p>
</li>
<li>
<p>Language Problem</p>
<p><img alt="1718199261159" src="../image/ADS/1718199261159.png" /></p>
</li>
</ul>
</li>
<li>
<p><strong>P: Polynomial Time</strong></p>
<ul>
<li>The class of problems that can be solved in polynomial time</li>
</ul>
</li>
<li>
<p><strong>NP: Nondeterministic Polynomial Time</strong></p>
<ul>
<li>The class of problems for which a solution can be verified in polynomial time</li>
</ul>
</li>
<li>
<p><strong>NP-Hard</strong></p>
<ul>
<li>
<p>A problem is NP-Hard if every problem in NP can be reduced to it in polynomial time (<span class="arithmatex">\(L^{'} \leq_p L\)</span>, not harder than)</p>
</li>
<li>
<p><strong>May not in NP</strong></p>
</li>
</ul>
</li>
<li>
<p><strong>NP-Complete</strong></p>
<ul>
<li>A problem is NP-Complete if it is <strong>in NP</strong> and is <strong>NP-Hard</strong></li>
</ul>
</li>
<li>
<p>Some items:</p>
<ul>
<li>
<p>deterministic turing machine: a machine that can only have one possible state at any time</p>
</li>
<li>
<p>non-deterministic turing machine: a machine that can have multiple possible states at any time, and can choose best one</p>
</li>
</ul>
</li>
<li>
<p>Some NPC problems</p>
<ul>
<li>
<p><strong>SAT</strong>: Given a boolean formula, is there an assignment of truth values to the variables that makes the formula true?</p>
</li>
<li>
<p><strong>3-SAT</strong>: Given a boolean formula in conjunctive normal form, where each clause has exactly 3 literals, is there an assignment of truth values to the variables that makes the formula true?</p>
</li>
<li>
<p><strong>Vertex Cover</strong>: Given a graph G and an integer k, is there a set of k vertices such that each edge in G is incident to at least one vertex in the set?</p>
</li>
<li>
<p><strong>Hamiltonian Cycle</strong>: Given a graph G, is there a simple cycle that visits every vertex exactly once?</p>
</li>
<li>
<p><strong>Subset Sum</strong>: Given a set of integers and an integer k, is there a subset of the integers that sums to k?</p>
</li>
<li>
<p><strong>Traveling Salesman Problem</strong>: Given a set of cities and distances between them, is there a tour that visits each city exactly once and has total length at most k?</p>
</li>
<li>
<p><strong>Knapsack Problem</strong>: Given a set of items, each with a weight and a value, and a knapsack with a weight limit, is there a subset of the items that fits in the knapsack and has total value at least k?</p>
</li>
<li>
<p><strong>Partition</strong>: Given a set of integers, is there a partition of the integers into two sets such that the sum of the integers in each set is equal?</p>
</li>
</ul>
</li>
</ul>
<details class="danger">
<summary>❌</summary>
<ul>
<li>
<p>SAT &amp; 3-SAT are NPC, but 2-SAT is P</p>
</li>
<li>
<p><img alt="1718196769316" src="../image/ADS/1718196769316.png" /></p>
<p>注意大O记号的含义！！！不一定要达到<span class="arithmatex">\(O(N^3)\)</span>!!!</p>
<p>Clique也是NPC</p>
</li>
<li>
<p><img alt="1718196847183" src="../image/ADS/1718196847183.png" /></p>
<p>NP包括P,可能X是P？那样应该一个都不对 </p>
</li>
<li>
<p><img alt="1718196879500" src="../image/ADS/1718196879500.png" /></p>
<p>傻逼了，显然DAG的最长路随便做</p>
<p>BC都是NPC，都是不可能有这么精确的算法的，有的话就P=NP了</p>
</li>
<li>
<p><img alt="1718196906484" src="../image/ADS/1718196906484.png" />  </p>
</li>
</ul>
</details>
<hr />
<h3 id="approximation">Approximation</h3>
<blockquote>
<p><span class="arithmatex">\(\rho(n)\)</span>-approximation algorithm: <span class="arithmatex">\(\max\{\frac{C}{C^*},\frac{C^*}{C}\}\leq \rho(n)\)</span></p>
</blockquote>
<ul>
<li>
<p>approximation scheme: <span class="arithmatex">\(\forall \epsilon &gt; 0, \exists \rho(n) \leq 1 + \epsilon\)</span></p>
</li>
<li>
<p>PTAS: Polynomial Time Approximation Scheme</p>
<p>复杂度为规模n的一个多项式</p>
</li>
<li>
<p>FPTAS: Fully Polynomial Time Approximation Scheme</p>
<p>复杂度同时为规模n以及 <span class="arithmatex">\(\frac{1}{\epsilon}\)</span> 的一个多项式</p>
</li>
<li>
<p>Some problems:</p>
<ul>
<li>
<p>Vertex Cover: <span class="arithmatex">\(\rho(n) = 2\)</span></p>
<ul>
<li>每次挑选一条边，将其两端的点加入集合，并删除对应邻边，直到所有边都被覆盖 </li>
</ul>
</li>
<li>
<p>Set Cover: <span class="arithmatex">\(\rho(n) = O(\log n)\)</span></p>
<ul>
<li>每次选择覆盖最多未覆盖元素的集合，直到所有元素都被覆盖</li>
</ul>
</li>
<li>
<p>三角不等式约束的TSP: <span class="arithmatex">\(\rho(n) = 2\)</span></p>
<ul>
<li>生成树的最小边权和即为TSP的下界，然后遍历生成树使得每条边恰好被访问两次，根据三角不等式，可以证明这个解为上界</li>
</ul>
</li>
<li>
<p>Bin packing</p>
<ul>
<li>
<p>Next Fit: <span class="arithmatex">\(\rho(n) = 2\)</span></p>
<ul>
<li>每次只考虑上一桶能否装下，则相邻桶相加必大于1,从而得出上界 </li>
</ul>
</li>
<li>
<p>First Fit: <span class="arithmatex">\(\rho(n) = 1.7\)</span>  </p>
<ul>
<li>每次找到第一个能装下的桶</li>
</ul>
</li>
<li>
<p>Best Fit：<span class="arithmatex">\(\rho(n) = 1.7\)</span></p>
<ul>
<li>每次找到最合适的桶（剩余空间最小的）</li>
</ul>
</li>
<li>
<p>Online：<span class="arithmatex">\(\rho(n) \geq \frac{5}{3}\)</span> </p>
</li>
<li>
<p>Offline: <span class="arithmatex">\(\rho(n) \leq \frac{11}{9}M+\frac{6}{9}\)</span></p>
</li>
</ul>
</li>
<li>
<p>Knapsack</p>
<ul>
<li>
<p>greedy</p>
<p><span class="arithmatex">\(P_{greedy} = \max \{P_{max},P_{density}\}\)</span></p>
<p><img alt="1714996604887" src="../image/ADS/1714996604887.png" />  </p>
</li>
<li>
<p>round</p>
<p><img alt="1714996744439" src="../image/ADS/1714996744439.png" /></p>
</li>
</ul>
</li>
<li>
<p>K-centers</p>
<ul>
<li>
<p>binary search &amp; check: <span class="arithmatex">\(\rho(n) = 2\)</span></p>
<ul>
<li>
<p>二分搜索半径，然后检查直径为2r是否能够覆盖所有点 </p>
<p><img alt="1714997132626" src="../image/ADS/1714997132626.png" /></p>
</li>
</ul>
</li>
<li>
<p>smarter way: <span class="arithmatex">\(\rho(n) = 2\)</span></p>
<p><img alt="1714997308174" src="../image/ADS/1714997308174.png" /> </p>
</li>
<li>
<p>lower bound: <span class="arithmatex">\(\rho(n) = 2\)</span></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<details class="danger">
<summary>❌</summary>
<ul>
<li>
<p><img alt="1718201093237" src="../image/ADS/1718201093237.png" /></p>
</li>
<li>
<p><img alt="1718201114837" src="../image/ADS/1718201114837.png" /></p>
</li>
</ul>
</details>
<h3 id="local-search">Local Search</h3>
<ul>
<li>
<p><strong>Gradient Descent</strong></p>
<ul>
<li>
<p>从一个初始解开始，每次选择一个邻域内的更优解，直到找不到更优解为止</p>
</li>
<li>
<p>但是可能会陷入局部最优解</p>
</li>
</ul>
</li>
<li>
<p><strong>Metropolis Algorithm</strong></p>
<ul>
<li>
<p>一种蒙特卡洛采样算法，以一定概率（<span class="arithmatex">\(e^{-\frac{\Delta{cost}}{kT}}\)</span>）接受更差的解，从而避免陷入局部最优解</p>
<p><img alt="1716288591558" src="../image/ADS/1716288591558.png" /></p>
</li>
</ul>
</li>
<li>
<p><strong>Simulated Annealing</strong></p>
<ul>
<li>模拟退火算法，是Metropolis Algorithm的一个变种，通过逐渐降低接受更差解的概率，从而逐渐收敛到全局最优解</li>
</ul>
</li>
<li>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Vertex Cover</p>
<ul>
<li>
<p>从全集开始，每次随机删除一个点，检查是否仍然是覆盖</p>
</li>
<li>
<p>可能会陷入局部最优解，可以通过Metropolis Algorithm或者Simulated Annealing来避免</p>
</li>
</ul>
</li>
<li>
<p>Hopfield Network</p>
<ul>
<li>
<p>Definations</p>
<p><img alt="1716288689372" src="../image/ADS/1716288689372.png" /></p>
</li>
<li>
<p>算法流程：每次随机翻转一个不稳定的点，直到所有点都稳定为止</p>
<p><img alt="1716289393712" src="../image/ADS/1716289393712.png" /></p>
</li>
<li>
<p>势能分析：<span class="arithmatex">\(\Phi(S) = \sum_{e \in good} |W_e|\)</span></p>
<p>那么每次翻转一个点，势能至少增大1，因此最多需要<span class="arithmatex">\(\sum_{e} |W_e|\)</span>次翻转，一定可以达到一个最大值</p>
</li>
</ul>
</li>
<li>
<p>Max-Cut</p>
<ul>
<li>
<p>类似 Hopfield Network，每次随机翻转一个点(更改阵营)，直到所有点都稳定为止</p>
</li>
<li>
<p>近似算法</p>
<p><img alt="1716290549633" src="../image/ADS/1716290549633.png" /></p>
<div class="admonition 简要证明">
<p class="admonition-title">简要证明</p>
<p>考虑<span class="arithmatex">\((1+\frac{1}{x})^x \geq 2\)</span>，代入<span class="arithmatex">\(x=\frac{|V|}{2\epsilon}\)</span>，则每<span class="arithmatex">\(x\)</span>次翻转势能至少增大为原来的2倍</p>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3 id="randomized-algorithm">Randomized Algorithm</h3>
<ul>
<li>
<p><strong>Hiring Problem</strong></p>
<p><em>(在数模课上已经研究过各种抽象版本了)</em></p>
<ul>
<li>
<p>Naive (Randomized Permutaion)</p>
<blockquote>
<p>每次雇佣比前面所有人都优秀的人</p>
</blockquote>
<ul>
<li>
<p>期望雇佣人数：</p>
<p>考虑第i个人为最优秀的概率为<span class="arithmatex">\(\frac{1}{i}\)</span>，则期望雇佣人数</p>
<div class="arithmatex">\[c_n = \sum_{i=1}^{n} \frac{1}{i} \approx \ln n\]</div>
</li>
</ul>
<div class="admonition randomizing permutaion">
<p class="admonition-title">Randomizing</p>
<ol>
<li>
<p>给每个元素随机赋予一个优先级（一般为<span class="arithmatex">\([1, n^3]\)</span>），然后按照优先级排序</p>
</li>
<li>
<p>对于每个元素<span class="arithmatex">\(i\)</span>，随机与<span class="arithmatex">\([i+1, n]\)</span>的某一个元素进行交换</p>
</li>
</ol>
</div>
</li>
<li>
<p>Online</p>
<blockquote>
<p>总共只雇佣1人，每次需要当场做决定</p>
</blockquote>
<ul>
<li>
<p>期望雇佣到最优秀的人：</p>
<p>考虑先考察前<span class="arithmatex">\(k\)</span>个人，然后使用前面的策略，即选择第一个比前面所有人都优秀的人</p>
<p>对于第<span class="arithmatex">\(i\)</span>个人，其为最优秀的概率为<span class="arithmatex">\(\frac{1}{n}\)</span></p>
<p>而他要被选到，需要前面位置在<span class="arithmatex">\([k+1, i-1]\)</span>的人都不被选，也即前面<span class="arithmatex">\(i-1\)</span>个人的最大值只能在<span class="arithmatex">\([1, k]\)</span>中，概率为<span class="arithmatex">\(\frac{k}{i-1}\)</span></p>
<p><strong>显然</strong>，上述两个条件是独立的，因此成功选到<span class="arithmatex">\(i\)</span>且他恰好是最优秀的概率为<span class="arithmatex">\(\frac{1}{n} \cdot \frac{k}{i-1}\)</span></p>
<p>从而雇佣到最优秀的人的概率为</p>
<div class="arithmatex">\[\sum_{i=k+1}^{n} \frac{1}{n} \cdot \frac{k}{i-1} = \frac{k}{n} \sum_{i=k}^{n-1} \frac{1}{i} \approx \frac{k}{n} \ln \frac{n}{k}\]</div>
<p>对<span class="arithmatex">\(k\)</span>求导，得到</p>
<div class="arithmatex">\[\frac{d}{dk} \frac{k}{n} \ln \frac{n}{k} = \frac{1}{n}（\ln{n} - \ln{k} - 1） = 0 \implies k = \frac{n}{e}\]</div>
<p>从而取<span class="arithmatex">\(k = \frac{n}{e}\)</span>时，概率最大，为<span class="arithmatex">\(\frac{1}{e}\)</span></p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Randomized Quick Sort</strong></p>
<ul>
<li>
<p>期望时间复杂度：<span class="arithmatex">\(O(n \log n)\)</span></p>
</li>
<li>
<p>最坏时间复杂度：<span class="arithmatex">\(O(n^2)\)</span> </p>
</li>
<li>
<p>证明：</p>
<p><strong>快速排序算法的复杂度本质上来源于划分时与pivot的比较次数</strong></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>为了便于分析，我们下面所说的第<span class="arithmatex">\(i\)</span>个元素，指的是在排序后的序列中的第<span class="arithmatex">\(i\)</span>个元素，而不是在原序列中的第<span class="arithmatex">\(i\)</span>个元素</p>
<p><strong>做到相关题目时需要小心！！！</strong></p>
</div>
<p>考虑第<span class="arithmatex">\(i\)</span>与第<span class="arithmatex">\(j\)</span>个元素的比较次数，显然最多比较1次，因为比较<strong>当且仅当</strong>其中一个被选为pivot，另一个被划分后不会再被比较</p>
<p>从而比较次数的期望<span class="arithmatex">\(E_{ij} = 1 \cdot P_{ij} = P_{ij}\)</span></p>
<p>而两者要比较，除了其中一个被选为pivot外，还需要他们没有被划分为到两边，即他们之间没有其他元素被选为pivot</p>
<p>因此，对于<span class="arithmatex">\([i,j]\)</span>这个子区间，pivot的选择是等概的，<span class="arithmatex">\(P_{ij} = \frac{2}{j-i+1}\)</span>（即选择<span class="arithmatex">\(i\)</span>或<span class="arithmatex">\(j\)</span>作为pivot的概率）</p>
<p>从而，对于整个序列，比较次数的期望为</p>
<div class="arithmatex">\[E(n) = \sum_{i=1}^{n-1} \sum_{j=i+1}^{n} P_{ij} = \sum_{i=1}^{n-1} \sum_{j=i+1}^{n} \frac{2}{j-i+1} &lt; 2n \sum_{k=1}^{n} \frac{1}{k} = O(n \log n)\]</div>
</li>
</ul>
<details class="danger">
<summary>❌</summary>
<ul>
<li><img alt="1718202979689" src="../image/ADS/1718202979689.png" /></li>
</ul>
</details>
<hr />
</li>
</ul>
<h3 id="parallel">Parallel</h3>
<p>通过并行加速算法的执行。很多时候为了挖掘并行性，可能会设计一个工作负载变大的算法，但是由于并行性，整体的运行效率反而会提高。</p>
<ul>
<li>
<p>运行基础：</p>
<ul>
<li>
<p>PRAM（Parallel Random Access Machine）</p>
</li>
<li>
<p>Access</p>
<p><img alt="1716796219037" src="../image/ADS/1716796219037.png" /></p>
</li>
</ul>
</li>
<li>
<p><strong>关键定义</strong></p>
<ul>
<li>
<p><span class="arithmatex">\(T_p\)</span> 表示p个处理器时的实际工作效率，也即处理器并行调用的次数</p>
</li>
<li>
<p><span class="arithmatex">\(W\)</span> (Workload) 表示总工作量，易知 <span class="arithmatex">\(W = T_1\)</span></p>
</li>
<li>
<p><span class="arithmatex">\(D\)</span> (Depth) 表示并行层数，易知 <span class="arithmatex">\(D = T_{\infty}\)</span></p>
</li>
<li>
<p><span class="arithmatex">\(\frac{W}{p} \leq T_p \leq \frac{W}{p} + D\)</span> </p>
</li>
</ul>
</li>
<li>
<p>Summation</p>
<ul>
<li>
<p>Balanced Binary Tree 模型（Bottom-Up）</p>
<p><span class="arithmatex">\(D = O(log N)\)</span> </p>
<p><span class="arithmatex">\(W = O(N)\)</span></p>
<p><img alt="1716797023603" src="../image/ADS/1716797023603.png" /></p>
</li>
</ul>
</li>
<li>
<p>Prefix-Summation</p>
<ul>
<li>
<p>由于需要计算前缀和，因此在上述计算出的B节点的基础上，进行Top-Down计算，计算每个节点到起最右节点的前缀和，记为C</p>
<p>更新策略：</p>
<ul>
<li>
<p>若为右儿子，则易得值和父节点相等</p>
</li>
<li>
<p>若为左儿子，则需要从上一层父节点的左兄弟获得前半段的结果，再累加上自己</p>
</li>
</ul>
<p><img alt="1716797772615" src="../image/ADS/1716797772615.png" /></p>
</li>
<li>
<p>复杂度相当于在原来算法的基础上多做了一遍而已，没有影响</p>
<p><span class="arithmatex">\(D = O(log N)\)</span> </p>
<p><span class="arithmatex">\(W = O(N)\)</span></p>
</li>
</ul>
</li>
<li>
<p>Merge</p>
<ul>
<li>
<p>考虑归并排序的merge环节，如果使用常规的串行来做，复杂度为线性<span class="arithmatex">\(O(N)\)</span></p>
<p>为了挖掘并行性，我们希望为每一个元素直接找到其合并后的顺序，而这本质上就是找两个序列中有多少个数比自己小：</p>
<p><strong>己方的由于有序已经通过位置得到，只要得到对方序列中的个数即可，而这本质上就是一个在有序序列中求rank问题</strong></p>
<p><img alt="1716799518583" src="../image/ADS/1716799518583.png" /></p>
</li>
<li>
<p>并行二分查找：</p>
<p>每个元素在对方序列中进行二分查找</p>
<p><span class="arithmatex">\(D = O(log N)\)</span></p>
<p><span class="arithmatex">\(W = O(N log N)\)</span></p>
</li>
<li>
<p>分块：</p>
<p>通过巧妙的设计平衡复杂度：</p>
<p>在每个序列中每 <span class="arithmatex">\(p\)</span>个元素 取一个pivot进行二分查找，找到其在对方序列中的位置</p>
<p><span class="arithmatex">\(D = O(logN),\qquad W = O(\frac{N}{p} \times logN)\)</span></p>
<p>此时根据连接关系，两个序列都被分成了小于等于<span class="arithmatex">\(p\)</span>的块，并且这些块应当按顺序与对应块进行合并，此时对对应的块之间调用朴素的串行方法进行合并即可</p>
<p><span class="arithmatex">\(D = O(p), \qquad W = O(N)\)</span></p>
<p><img alt="1716800170720" src="../image/ADS/1716800170720.png" /></p>
<p>综上，若取<span class="arithmatex">\(p=logN\)</span>，得到</p>
<p><span class="arithmatex">\(D = O(log N)\)</span></p>
<p><span class="arithmatex">\(W = O(N)\)</span></p>
</li>
</ul>
</li>
<li>
<p>Maximum Finding</p>
<details>
<summary>结论速览</summary>
<table>
<thead>
<tr>
<th></th>
<th><span class="arithmatex">\(W\)</span></th>
<th><span class="arithmatex">\(D\)</span></th>
</tr>
</thead>
<tbody>
<tr>
<td>朴素分治</td>
<td><span class="arithmatex">\(O(logN)\)</span></td>
<td><span class="arithmatex">\(O(NlogN)\)</span></td>
</tr>
<tr>
<td>并行二重循环</td>
<td><span class="arithmatex">\(O(1)\)</span></td>
<td><span class="arithmatex">\(O(N^2)\)</span></td>
</tr>
<tr>
<td>递归分块（<span class="arithmatex">\(p=\sqrt{N}\)</span>）</td>
<td><span class="arithmatex">\(O(loglogN)\)</span></td>
<td><span class="arithmatex">\(O(NloglogN)\)</span></td>
</tr>
<tr>
<td>递归分块（<span class="arithmatex">\(p=loglogN\)</span>）</td>
<td><span class="arithmatex">\(O(loglogN)\)</span></td>
<td><span class="arithmatex">\(O(N)\)</span></td>
</tr>
<tr>
<td>随机采样</td>
<td><span class="arithmatex">\(O(1)\)</span></td>
<td><span class="arithmatex">\(O(N)\)</span></td>
</tr>
</tbody>
</table>
</details>
<ul>
<li>
<p>利用前面求和类似的<strong>Balanced Binary Tree 分治</strong></p>
<p><span class="arithmatex">\(D = O(logN)\)</span></p>
<p><span class="arithmatex">\(W = O(N)\)</span></p>
</li>
<li>
<p>充分挖掘并行性，采用<strong>并行的二重循环</strong>，即并行进行<span class="arithmatex">\(N^2\)</span>对比较，一旦有一组比较不满足则淘汰（需要common CRCW策略支持）</p>
<p><span class="arithmatex">\(D = O(1)\)</span></p>
<p><span class="arithmatex">\(W = O(N^2)\)</span></p>
</li>
<li>
<p>考虑<strong>递归分块</strong>，可以得到所谓 <strong>Doubly-logarithmic Paradigm</strong></p>
<p>若每<span class="arithmatex">\(p\)</span>个分成一块，块与块之间并行处理，最后对<span class="arithmatex">\(\frac{N}{p}\)</span>块进行汇总，则容易得到复杂度的递推式</p>
<p><span class="arithmatex">\(D(N) = D(p) + F_D(\frac{N}{p}), \qquad W(N) = \frac{N}{p}W(p) + F_W(\frac{N}{p})\)</span></p>
<p>若都采用上述 <strong>并行二重循环</strong> 的方法，则有 </p>
<p><span class="arithmatex">\(D(N) = D(p) + O(1), \qquad W(N) = \frac{N}{p}W(p) + O((\frac{N}{p})^2)\)</span></p>
<p>取<span class="arithmatex">\(p=\sqrt{N}\)</span>，可以得到优化：</p>
<p><span class="arithmatex">\(D(N) = O(loglogN)\)</span></p>
<p><span class="arithmatex">\(W(N) = O(N log log N)\)</span></p>
</li>
<li>
<p><strong>究极硬凑</strong></p>
<p>在前面递归分块得到的比较优秀的算法基础上，考虑先使用<span class="arithmatex">\(p=loglogN\)</span>分块，每一个块内直接用朴素的串行线性算法进行求解，而合并时使用上方的<strong>递归分块</strong>方法</p>
<p><span class="arithmatex">\(D(N) = O(p) + O(loglog \frac{N}{p}) = O(loglogN)\)</span></p>
<p><span class="arithmatex">\(W(N) = O(N) + O(\frac{N}{p} loglog \frac{N}{p}) = O(N)\)</span></p>
</li>
<li>
<p><strong>随机采样</strong></p>
<ol>
<li>
<p>随机选取<span class="arithmatex">\(N^{\frac{7}{8}}\)</span>个元素作为采样的序列</p>
<p><span class="arithmatex">\(D = O(1), \qquad W = O(N^{\frac{7}{8}})\)</span></p>
</li>
<li>
<p>每<span class="arithmatex">\(N^{\frac{1}{8}}\)</span>为一块分组，得到<span class="arithmatex">\(N^{\frac{3}{4}}\)</span>块，每组内使用 <strong>并行二重循环</strong> 进行求解最大值</p>
<p><span class="arithmatex">\(D = O(1), \qquad W = O(N^{\frac{3}{4}} \times (N^{\frac{1}{8}})^2) = O(N)\)</span></p>
</li>
<li>
<p>每<span class="arithmatex">\(N^{\frac{1}{4}}\)</span>为一块分组，得到<span class="arithmatex">\(N^{\frac{1}{2}}\)</span>块，每组内使用 <strong>并行二重循环</strong> 进行求解最大值</p>
<p><span class="arithmatex">\(D = O(1), \qquad W = O(N^{\frac{1}{2}} \times (N^{\frac{1}{4}})^2) = O(N)\)</span></p>
</li>
<li>
<p>剩下的 <span class="arithmatex">\(N^{\frac{1}{2}}\)</span> 块直接使用 <strong>并行二重循环</strong> 求解最终答案</p>
<p><span class="arithmatex">\(D = O(1), \qquad W = O((N^{\frac{1}{2}})^2) = O(N)\)</span></p>
</li>
</ol>
<p>综上，总复杂度为</p>
<p><span class="arithmatex">\(D=O(1)\)</span></p>
<p><span class="arithmatex">\(W=O(N)\)</span></p>
<details>
<summary>补充说明</summary>
<p><img alt="1716803496033" src="../image/ADS/1716803496033.png" /></p>
</details>
</li>
</ul>
</li>
</ul>
<h3 id="external-sorting">External Sorting</h3>
<ul>
<li>
<p><strong>External Memory Model</strong></p>
<ul>
<li>
<p>有内存和外存之分，内存可以快速进行随机访问，而外存实现随机访问需要开销很大的I/O操作</p>
</li>
<li>
<p>通常内存远小于外存，因此需要设计一些算法，在内存里进行实际排序，在外存中只进行尽可能少的顺序I/O操作</p>
</li>
</ul>
</li>
<li>
<p>一些基本概念</p>
<ul>
<li>
<p><strong>Block</strong>：内存和外存之间的数据传输单位，可以认为是一个固定大小的数据块</p>
</li>
<li>
<p><strong>Run</strong>：一次内存排序的结果，即一个有序的子序列，初始一般为内存大小</p>
</li>
<li>
<p><strong>Tape</strong>：抽象模型，可以理解为顺序读写的磁头，一般 k-way merge 需要 k + 1 个tape</p>
</li>
<li>
<p><strong>Pass</strong>：一次内存排序的过程，即将外存数据读入内存，进行排序，然后写回外存</p>
</li>
</ul>
</li>
<li>
<p><strong>External Merge Sort</strong></p>
<ul>
<li>
<p>Split：</p>
<ul>
<li>
<p>常规：将外存数据分成若干块，每块大小为内存大小，然后在内存中调用内部排序算法进行排序，写回磁盘</p>
</li>
<li>
<p><strong>Replacement Selection</strong>：</p>
<blockquote>
<p>增大run的初始大小，降低pass的次数，提高效率</p>
</blockquote>
<p>大佬Donald Knuth发明的算法：使用内存维护一个堆，每次将堆顶元素写入外存，然后将新元素加入堆。若新写入的元素比当前run的末尾元素小，则应该新开一个run,此时直接将该元素放到内存末尾，即内存前半部分为堆空间，后半部分为下一个run的缓存，等到堆空间为空则进行重建堆继续上述过程。</p>
<p>可以使用所谓“snowplow”理论感性理解其run的大小会增大为原来的两倍，从而减少pass的次数</p>
</li>
</ul>
</li>
<li>
<p>Merge：</p>
<ul>
<li>
<p>k-way merge：</p>
<p>将k个run的第一个元素块读入内存，留下一个内存块作为输出buffer, 使用堆进行k路归并排序，然后将结果写回外存，直到所有run都被合并</p>
<p>这样所需的内存为<span class="arithmatex">\(block = k+1\)</span></p>
<p>优化的<span class="arithmatex">\(pass = 1 + \lceil \log_k(runs) \rceil\)</span></p>
</li>
<li>
<p><strong>并行优化：</strong></p>
<p>上述朴素的多路合并算法有个问题，当某路的数据块处理完时，整个算法会被阻塞，等待这一路的新数据块写入（一般认为数据块不能同时读写）</p>
<p>为此，可以考虑使用并行手段，每个数据块分成2部分，一部分为当前处理的数据块，另一部分为并行写入下一个数据块，从而避免阻塞（输出buffer同理）</p>
<p>此时需要的<span class="arithmatex">\(block = 2 k + 2\)</span></p>
</li>
<li>
<p><strong>tape 优化</strong></p>
<p>朴素的k-way merge算法需要k+1个tape，但是实际上可以通过一些技巧，充分利用空间，达到只需k个tape</p>
<div class="admonition example">
<p class="admonition-title">以二路归并为例</p>
<p><img alt="1717481621618" src="../image/ADS/1717481621618.png" /></p>
<p>通过分配初始run的个数为斐波那契数列，每次的run的个数可以辗转相减、滚动减小</p>
</div>
<p>对于k路归并，可以通过类似的方法，使用k阶斐波那契数列</p>
<p>但是这样的方法显然会导致pass的次数增加，因此需要权衡</p>
</li>
</ul>
<details class="note">
<summary>迭代归并</summary>
<p>对于多路归并，除了使用堆进行辅助外，还可以使用迭代归并的方法，即每次合并两个run</p>
<p>“合并果子”即视感，可以使用哈夫曼树进行优化</p>
<p><img alt="1717485368247" src="../image/ADS/1717485368247.png" /></p>
</details>
</li>
</ul>
</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a7c05c9e.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../javascripts/katex.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>